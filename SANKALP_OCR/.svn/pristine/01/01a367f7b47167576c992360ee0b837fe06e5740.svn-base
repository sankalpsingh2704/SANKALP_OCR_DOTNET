@*@model InvoiceNew.Models.InvoiceModel *@
@model InvoiceNew.Models.InvoiceModel
@using System.Collections;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    <!-- Custom Fonts -->
    <link href="~/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    @*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
    @*<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>*@
    @*<script src="~/Scripts/bootstrap.min.js"></script>*@
 
 
    <script>
       



        //$(function () {  
        //    $('.ledgerlistNames').multiselect({  
            
        //        includeSelectAllOption: true , 

        //        buttonWidth: '200px',
        //    buttonText: function (options) {
        //        if (options.length == 0) {
        //            return '0 Selected';
        //        } else {
        //            var selected = 0;
        //            options.each(function () {
        //                selected += 1;
        //            });
        //            return selected +  'Selected';
        //        }
        //    }
        //    });  
            
        //});  
          
       
    </script>
    <style>
        .icon-navbar{
            height:auto;
            width:100px;
            float:left;
            margin-left:10px;
        }
        #remove{
            cursor: pointer;
        }
        #imgviewer{
            float:right;
            position:relative;
            height:600px;
            width:500px;
            /*left:160px;
            top:57px;*/
            overflow:auto;
            background-color:rgba(0,0,0,0);
        }
        #plus, #minus{
            cursor:pointer;
        }
        
        
    </style>

    //var myid = "";
}
@if (@ViewBag.appstate == "Edit")
{
    <style>
        .zoom-icon {
            position: absolute;
            top: 623px;
            left: 420px;
        }
    </style>
    <div class="wrapper" style="background-color:#FFFFFF">
        @*@using (Html.BeginForm("SubmitInvoice", "Invoice",FormMethod.Post))*@
        @using (Html.BeginForm("UpdateInvoiceEdited", "Invoice", FormMethod.Post, new { id = "invoceupdateform", enctype = "multipart/form-data" }))
        {
            <div id="Inv">

                <div id="page-wrapper">
                    <div class="">
                        @*<div class="col-lg-12">
                                <h1 class="page-header">Invoice Reader</h1>
                            </div>*@
                        <!-- /.col-lg-12 -->
                    </div>
                    <!-- /.row -->

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="panel panel-info" style="margin-left:10px;margin-top:10px;">
                                <div class="panel-heading">
                                    <h5><b>INVOICE</b></h5>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body" style="padding-top:15px;padding-left:0;height: 1200px;">
                                    <table>
                                        <tr>
                                            <td style="color:green">@Html.Raw(ViewBag.ErrMsg)</td>
                                        </tr>
                                    </table>
                                    <table id="icon-navbar" class="icon-navbar">
                                        <thead>
                                            <tr><td></td></tr>
                                        </thead>
                                    </table>
                                    <object id="object_id" style="float:right;" data='@Url.Action("GetFile", "Invoice", new { @filepath = Model.filePath })' width="600" height="725"></object>
                                    <div id="imgviewer">
                                        <img id="view" width="500" height="600" src="#" alt="Alternate Text" />
                                       
                                    </div>
                                    <div class="zoom-icon">
                                        <img id="plus" src="~/Content/images/plus.png" height="25" width="25" />
                                        <img id="minus" src="~/Content/images/minus.png" height="20" width="20" />
                                    </div>
                                    <br />
                                    <div style="height:62px;width:481px;float:right;">
                                        <span id="remove" class="glyphicon glyphicon-remove" style="float:left;font-size:30px;"></span>
                                        <input style="float: left;margin-left: 81px;margin-top: 6px;width: 100px;" type="file" name="UploadSupportFile" id="SupportFile" multiple="multiple" onchange="addToInvoiceImagesList();">
                                    </div>
                                </div>

                                <!-- .panel-body -->
                            </div>
                            <!-- /.panel -->
                        </div>
                        <!-- /.col-lg-6 -->
                        <div id="divInvoice">
                            <div class="col-sm-6 col-md-6" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;margin-top:10px;">
                                    <div class="panel-heading">
                                        <h5><b>VENDOR DETAILS</b></h5>
                                    </div>
                                    <!-- /.panel-heading -->
                                    <div class="panel-body">
                                        <table id="InvoiceInfo" class="display table table-bordered table-hover">
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight:bold;">Security</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.SecurityName, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.SecurityName)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.GateEntryNumber)</td>
                                                    <td>
                                                        @Html.TextBoxFor(m => m.GateEntryNumber, new { @class = "form-control",@readonly="readonly" })
                                                        @Html.ValidationMessageFor(m => m.GateEntryNumber)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Document Type</td>
                                                    <td>
                                                        @Html.TextBoxFor(m => m.SelectedType, new { @class = "form-control", @readonly = "readonly" })
                                                        @Html.ValidationMessageFor(m => m.SelectedType)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.VehicleNumber)</td>
                                                    <td>
                                                        @Html.TextBoxFor(m => m.VehicleNumber, new { @class = "form-control", @readonly = "readonly" })
                                                        @Html.ValidationMessageFor(m => m.VehicleNumber)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.Date)</td>
                                                    <td>
                                                        @Html.TextBoxFor(m => m.Date,"{0:dd/MM/yyyy }", new { @class = "form-control", @readonly = "readonly" })
                                                        @Html.ValidationMessageFor(m => m.Date)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.Time)</td>
                                                    <td>
                                                        @Html.TextBoxFor(m => m.Time, new { @class = "form-control", @readonly = "readonly" })
                                                        @Html.ValidationMessageFor(m => m.Time)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">Invoice No.</td>
                                                    <td>
                                                        @Html.HiddenFor(m => m.InvoiceID)
                                                        @Html.TextBoxFor(m => m.InvoiceNumber, new { @class="form-control" })
                                                        @Html.ValidationMessageFor(m => m.InvoiceNumber)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Amount</td>
                                                    <td id="lblInvoiceAmount">
                                                        @Html.TextBoxFor(m => m.InvoiceAmount,new { @class="form-control"})
                                                        @Html.Hidden("hdnInvoiceAmount")
                                                        @Html.Hidden("hdnTotalAmount")
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Date</td>
                                                    <td>
                                                      
                                                        @Html.TextBoxFor(m => m.InvoiceDate, "{0:dd/MM/yyyy }", new { @class = "form-control date" })
                                                        @Html.ValidationMessageFor(m => m.InvoiceDate)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Received Date</td>
                                                    <td>
                                                      
                                                        @Html.TextBoxFor(m => m.InvoiceReceiveddate , "{0:dd/MM/yyyy }", new { @class = "form-control date" })
                                                        @Html.ValidationMessageFor(m => m.InvoiceReceiveddate)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Due Date</td>
                                                    <td>
                                                       
                                                        @Html.TextBoxFor(m => m.InvoiceDueDate, "{0:dd/MM/yyyy }", new { @class = "form-control date" })
                                                        @Html.ValidationMessageFor(m => m.InvoiceDueDate)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">PO Number</td>
                                                    <td>@Html.TextBoxFor(m => m.PONumber, new { @class = "form-control" })</td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">PAN Number</td>
                                                    <td>@Html.TextBoxFor(m => m.PANNumber, new { @class = "form-control" })</td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">Vendor Name</td>
                                                    <td>
                                                      
                                                        @Html.HiddenFor(m => m.VendorID)
                                                        @Html.TextBoxFor(m => m.VendorName, new { @class = "form-control", @id = "drpvendorid" })
                                                    </td>
                                                </tr>
                                               

                                                <tr>
                                                    <td style="font-weight:bold;">GSTIN</td>
                                                    <td>@Html.TextBoxFor(m=> m.GSTIN,new { @class="form-control"})</td>
                                                </tr>
                                                @*
    <tr>
        <td style="font-weight:bold;">Place of Supply</td>
        <td>@Html.TextBoxFor(m => m.PlaceOfSupply,new { @class="form-control"})</td>
    </tr>
    <tr>
        <td style="font-weight:bold;">Reverse Charges</td>
        <td>
            @Html.RadioButtonFor(m => m.ReverseCharges, "false") No
            @Html.RadioButtonFor(m => m.ReverseCharges, "true") Yes
        </td>
    </tr>
    <tr>
        <td style="font-weight:bold;">Ecommerce GSTIN</td>
        <td>@Html.TextBoxFor(m => m.EcommerceGSTIN, new { @class = "form-control" }) </td>
    </tr>
    <tr>
        <td style="font-weight:bold;">Tax Percent</td>
        <td>@Html.TextBoxFor(m => m.TaxPercent, new { @class = "form-control" })</td>
    </tr>
    <tr>
        <td style="font-weight:bold;">Taxable Value</td>
        <td>@Html.TextBoxFor(m => m.TaxableValue,new { @class = "form-control" })</td>
    </tr>

    <tr>
        <td style="font-weight:bold;">Cess Amount</td>
        <td>@Html.TextBoxFor(m => m.CessAmount, new { @class = "form-control" } )</td>
    </tr>
                                                *@

                                                @if (ViewBag.Showledger)
                                                {
                                                    if(ViewBag.ERP == true)
                                                    {
                                                    <tr>
                                                        <td style="font-weight:bold;">Ledger Names</td>
                                                        <td>
                                                            @*<select id = "ledgerlist"  name="ledgerlist"
                                                                multiple = "multiple"
                                                                 > @if (ViewBag.LedgerNames != null)
                                                                 {
                                                                     foreach (var item in ViewBag.LedgerNames)
                                                                     {
                                                                         if (item.Text != null)
                                                                         {
                                                                             <option value = "@item.Value" > @item.Text </option>
                                                                         }

                                                                     }
                                                                 } </select>*@

                                                            @Html.ValidationMessageFor(model => Model.ledgerlist)
                                                        
                                                        @Html.TextBoxFor(m => m.ledgerlist, new { @class = "form-control" })
                                                       @* @Html.DropDownListFor(model => Model.ledgerlist, new SelectList(ViewBag.LedgerNames, "Value", "Text"), new { @class = "ddlUsers form-control" }) *@
                                                           
                                                        @* @Html.DropDownList("ledgerlist", new SelectList(ViewBag.LedgerNames, "Value", "Text")) *@
                                                      </td>
                                                    </tr>
                                                }
                                                    else
                                                    {
                                                  
                                                           <tr>
                                                                <td>
                                                                    <input type="hidden" name="ledgerlist" value="@(Model.ledgerlist)" />
                                                                </td>
                                                           </tr>
                                                 
                                                    }
                                                }
                                                
                                            
                                                
                                                @if (Model.UserTypes != null)
                                                {
                                                    for (int i = 0; i < Model.UserTypes.Count; i++)
                                                    {

                                                    <tr class="RowClass">
                                                        <td style="font-weight:bold;">@Html.DisplayFor(m => m.UserTypes[i].UserTypeName)</td>
                                                        <td>
                                                            @Html.HiddenFor(m => m.UserTypes[i].UserID)
                                                            @Html.HiddenFor(m => m.UserTypes[i].UserName)
                                                            @Html.HiddenFor(m => m.UserTypes[i].UserTypeID)
                                                            @Html.HiddenFor(m => m.UserTypes[i].UserTypeName)
                                                            @Html.DropDownListFor(model => Model.UserTypes[i].SelectedUserId, new SelectList(Model.UserTypes[i].Users, "Value", "Text", Model.UserTypes[i].SelectedUserId), new { @class = "ddlUsers form-control" })
                                                        </td>
                                                    </tr>
                                                    }
                                                }
                                                @*
    @if (Model.UserTypes != null)
    {
        for (int i = 0; i < Model.UserTypes.Count; i++)
        {
            <tr class="RowClass">
                <td style="font-weight:bold;">@Html.DisplayFor(m => m.UserTypes[i].UserTypeName)</td>
                <td>@Html.DisplayFor(m => m.UserTypes[i].UserName, new { @class = "form-control" })</td>
            </tr>
        }
    }*@
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- .panel-body -->
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-12" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                    <div class="panel-heading">
                                        <span class="widget-icon"> <i class="fa-lg fa fa-th-list"></i></span>
                                        <b>ITEM LIST</b>
                                    </div>
                                    <div class="panel-body items">
                                        <style>
                                            display tbody tr:nth-child(2n+1) {
                                                background-color: #f9f9f9;
                                            }

                                            
                                            .item-list td{
                                                width: 115px;
                                            }

                                            .item-list .form-control{
                                                width: 100px;
                                            }
                                            .panel-body.items {
                                                overflow-x:scroll;
                                            }

                                            .name-des + span,.calculate + span {
                                                color: red;
                                                display: none;
                                                font-size: 10px;
                                            }

                                            .name-des-error {
                                                display: block !important;
                                            }

                                            .name-des-error-input {
                                                border: 1px solid #ff0000;
                                                background-color: #ffeeee;
                                            }

                                        </style>
                                        <table class="item-list table table-bordered table-hover table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Name Description</th>
                                                    <th>UOM</th>
                                                    <th>HSN</th>
                                                    <th>Price</th>
                                                    <th>QTY</th>
                                                    <th>Amount</th>
                                                    
                                                    <th>IGST</th>
                                                    <th>I.Amount</th>
                                                    <th>SGST</th>
                                                    <th>S.Amount</th>
                                                    <th>CGST</th>
                                                    <th>C.Amount</th>   
                                                    <th>Total</th>
                                                    
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            
                                          
                                        @foreach(var item in Model.InvoiceItems)
                                        {

                                            <tr id=@(Model.InvoiceItems.IndexOf(item)) class="list">

                                                <td><input type="hidden" id=@("update"+Model.InvoiceItems.IndexOf(item)) name=@("update"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Id />
                                              @*     @Html.HiddenFor(m => m.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Name, new { id= "name" + Model.InvoiceItems.IndexOf(item), Name = "name" + Model.InvoiceItems.IndexOf(item) }) *@ 
                                                     <input type="hidden" id=@("itemName"+Model.InvoiceItems.IndexOf(item)) name=@("itemName"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Name />
                                                    @*<select class="form-control name-des" id=@("namedes"+Model.InvoiceItems.IndexOf(item)) name=@("namedes"+Model.InvoiceItems.IndexOf(item)) ></select></td>*@
                                                    <input class="form-control name-des" type="text" id=@("namedes"+Model.InvoiceItems.IndexOf(item)) name=@("namedes"+Model.InvoiceItems.IndexOf(item)) />
                                                    <span>Item Name can't be empty</span>     
                                                     <input type="hidden" name=@("namedes-id"+Model.InvoiceItems.IndexOf(item)) id=@("namedes-id"+Model.InvoiceItems.IndexOf(item)) value="" />
                                                </td>
                                                <td>@Html.TextBoxFor(m => item.UOM, new { id = "uom" + Model.InvoiceItems.IndexOf(item), Name = "uom" + Model.InvoiceItems.IndexOf(item), @class = "form-control" })
                                                @*<input class="form-control" type="text" id=@("uom"+Model.InvoiceItems.IndexOf(item)) name=@("uom"+Model.InvoiceItems.IndexOf(item)) >*@ </td>
                                                <td>@Html.TextBoxFor(m => item.HSN, new { id = "hsncode" + Model.InvoiceItems.IndexOf(item), Name = "hsncode" + Model.InvoiceItems.IndexOf(item), @class = "form-control" })
                                                @*<input class="form-control" type="text" id=@("hsncode"+Model.InvoiceItems.IndexOf(item)) name=@("hsncode"+Model.InvoiceItems.IndexOf(item)) >*@ </td>
                                                <td>
                                                    @Html.TextBoxFor(m => item.Price, new { id = "price" + Model.InvoiceItems.IndexOf(item), Name = "price" + Model.InvoiceItems.IndexOf(item), @class = "form-control calculate" })
                                                    <span>Price can't be empty</span>
                                                </td>
                                               @* <input class="form-control calculate" type="text" id=@("price"+Model.InvoiceItems.IndexOf(item)) name=@("price"+Model.InvoiceItems.IndexOf(item))>*@ 

                                                
                                                @*<!--
    <td><input type="hidden" name=@("update"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Id >
     Html.TextBoxFor(m => item.ItemId, new { id = "id" + Model.InvoiceItems.IndexOf(item), Name = "id" + Model.InvoiceItems.IndexOf(item), @class = "form-control" })</td> -->*@
                                       
                                              @*  <td><input type="hidden" name=@("update"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Id>
    @Html.TextBoxFor(m => item.Code,new { id = "code" + Model.InvoiceItems.IndexOf(item), Name = "code" + Model.InvoiceItems.IndexOf(item), @class ="form-control"})</td>*@
                                                @*<td>@Html.TextBoxFor(m => item.Name, new { id = "name" + Model.InvoiceItems.IndexOf(item), Name = "name"+Model.InvoiceItems.IndexOf(item), @class = "form-control" })</td> *@
                                                <td>@Html.TextBoxFor(m => item.Qty, new { id = "qty" + Model.InvoiceItems.IndexOf(item), Name = "qty"+Model.InvoiceItems.IndexOf(item), @class = "form-control calculate" }) <span>Qty can't be empty</span></td>
                                                <td>@Html.TextBoxFor(m => item.Amount, new { id = "amount" + Model.InvoiceItems.IndexOf(item), Name = "amount"+Model.InvoiceItems.IndexOf(item), @class = "form-control", @Readonly = "readonly" })</td>
                                                <td>@Html.TextBoxFor(m => item.IGST, new { id = "igst" + Model.InvoiceItems.IndexOf(item), Name = "igst" + Model.InvoiceItems.IndexOf(item), @class = "form-control calculate" }) <span>IGST can't be empty</span></td>
                                                <td>@Html.TextBoxFor(m => item.IAmount, new { id = "igstamount" + Model.InvoiceItems.IndexOf(item), Name = "igstamount" + Model.InvoiceItems.IndexOf(item),@readonly="readonly" , @class = "form-control" })</td>
                                                <td>@Html.TextBoxFor(m => item.SGST, new { id = "sgst" + Model.InvoiceItems.IndexOf(item), Name = "sgst" + Model.InvoiceItems.IndexOf(item), @class = "form-control calculate" }) <span>SGST can't be empty</span></td>
                                                <td>@Html.TextBoxFor(m => item.SAmount, new { id = "sgstamount" + Model.InvoiceItems.IndexOf(item), Name = "sgstamount" + Model.InvoiceItems.IndexOf(item), @readonly = "readonly", @class = "form-control"})</td>
                                                <td>@Html.TextBoxFor(m => item.CGST, new { id = "cgst" + Model.InvoiceItems.IndexOf(item), Name = "cgst" + Model.InvoiceItems.IndexOf(item), @class = "form-control calculate" }) <span>CGST can't be empty</span></td>
                                                <td>@Html.TextBoxFor(m => item.CAmount, new { id = "cgstamount" + Model.InvoiceItems.IndexOf(item), Name = "cgstamount" + Model.InvoiceItems.IndexOf(item), @readonly = "readonly", @class = "form-control" })</td>
                                                <td>@Html.TextBoxFor(m => item.Total, new { id = "total"+Model.InvoiceItems.IndexOf(item), Name = "total"+Model.InvoiceItems.IndexOf(item), @readonly = "readonly", @class = "form-control" })</td>
   @* <td> <select id=@("ledgerlistNames" +Model.InvoiceItems.IndexOf(item)) name=@("ledgerlistNames" +Model.InvoiceItems.IndexOf(item)) class="ledgerlistNames" multiple="multiple">
        @if (ViewBag.LedgerlistNames != null)
        {
            foreach (var itemN in ViewBag.LedgerlistNames)
            {
                if (itemN.Text != null)
                {
                    <option value="@itemN.Value"> @itemN.Text </option>
                }

            }
        }

        </select>
    </td>*@                                     <!--
                                                <td><input class="form-control" type="text" id=@("amount"+Model.InvoiceItems.IndexOf(item)) name=@("amount"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Amount ></td>
                                                
                                                <td><input class="form-control calculate" type="text" id=@("igst"+Model.InvoiceItems.IndexOf(item)) name=@("igst"+Model.InvoiceItems.IndexOf(item)) ></td>
                                                <td><input class="form-control" readonly="readonly" type="text" id=@("igstamount"+Model.InvoiceItems.IndexOf(item)) name=@("igstamount"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].IAmount></td>
                                                <td><input class="form-control calculate" type="text" name=@("sgst"+Model.InvoiceItems.IndexOf(item)) id=@("sgst"+Model.InvoiceItems.IndexOf(item))></td>
                                                <td><input class="form-control" readonly="readonly" type="text" id=@("sgstamount"+Model.InvoiceItems.IndexOf(item)) name=@("sgstamount"+Model.InvoiceItems.IndexOf(item))  value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].SAmount></td>
                                                <td><input class="form-control calculate" type="text" id=@("cgst"+Model.InvoiceItems.IndexOf(item)) name=@("cgst"+Model.InvoiceItems.IndexOf(item))></td>
                                                <td><input class="form-control" readonly="readonly" type="text" id=@("cgstamount"+Model.InvoiceItems.IndexOf(item)) name=@("cgstamount"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].CAmount></td>
                                                <td><input class="form-control" readonly="readonly" type="text" id=@("total"+Model.InvoiceItems.IndexOf(item)) name=@("total"+Model.InvoiceItems.IndexOf(item)) value=@Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].Total></td>
                                                -->
                                                <td>
                                                    @if (Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].GRN == "1")
                                                    {
                                                        <input class="grn-enabled" checked="checked" type="checkbox" value="true" id=@("grnenable"+Model.InvoiceItems.IndexOf(item)) name=@("grnenable"+Model.InvoiceItems.IndexOf(item)) />@Html.Raw("GRN ENABLED")
                                                    }
                                                    else
                                                    {
                                                        <input class="grn-enabled" type="checkbox" value="true" id=@("grnenable"+Model.InvoiceItems.IndexOf(item)) name=@("grnenable"+Model.InvoiceItems.IndexOf(item)) />@Html.Raw("GRN ENABLED")
                                                    }
                                                </td>
                                               
                                                  <td><button type="button" id=@("delete"+Model.InvoiceItems.IndexOf(item)) class='delete btn btn-primary'>DELETE</button></td>
                                                </tr>
                                            if (Model.InvoiceItems[Model.InvoiceItems.IndexOf(item)].GRN == "1")
                                            {
                                                <tr id=@("grn" + Model.InvoiceItems.IndexOf(item))>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>@Html.TextBoxFor(m => item.GRNPrice, new { id = "grnprice" + Model.InvoiceItems.IndexOf(item), Name = "grnprice" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNQty, new { id = "grnqty" + Model.InvoiceItems.IndexOf(item), Name = "grnqty" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNAmount, new { id = "grnamount" + Model.InvoiceItems.IndexOf(item), Name = "grnamount" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal",@Readonly="readonly" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNIGST, new { id = "grnigst" + Model.InvoiceItems.IndexOf(item), Name = "grnigst" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNIAmount, new { id = "grnigstamount" + Model.InvoiceItems.IndexOf(item), Name = "grnigstamount" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal", @Readonly = "readonly" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNSGST, new { id = "grnsgst" + Model.InvoiceItems.IndexOf(item), Name = "grnsgst" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNSAmount, new { id = "grnsgstamount" + Model.InvoiceItems.IndexOf(item), Name = "grnsgstamount" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal", @Readonly = "readonly" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNCGST, new { id = "grncgst" + Model.InvoiceItems.IndexOf(item), Name = "grncgst" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNCAmount, new { id = "grncgstamount" + Model.InvoiceItems.IndexOf(item), Name = "grncgstamount" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal", @Readonly = "readonly" })</td>
                                                    <td>@Html.TextBoxFor(m => item.GRNTotal, new { id = "grntotal" + Model.InvoiceItems.IndexOf(item), Name = "grntotal" + Model.InvoiceItems.IndexOf(item), @class = "form-control grncal", @Readonly = "readonly" })</td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            }
                                        }
                                                </tbody>
                                        </table>
                                    </div>
                                    <input style="margin-left: 40px;" type="button" id="addItem" value="ADD" class="btn btn-primary" />
                                </div>
                            </div>
                            <script>
                                var localJSON = {};
                            </script>
                            @if (ViewBag.catdata == "yes")
                            {


                                <script>
                                    
                                    localJSON = @Html.Raw(ViewBag.SelectedData);
                                    //console.log(localJSON.Data.category);
                                    /*
                                    $.get("getPreSelectValue",function(data,status){
                                        console.log(data);
                                    });
                                    */
                                </script>
                            }   

                            <script>
                                $(function(){
                                    var CatList = {};

                                    $.get("getAllCategoryName",function(data,status){

                                        console.log(data)
                                        //console.log(localJSON.Data.category);
                                        //var selectedcat = 
                                        
                                        CatList = data.CategoryList;
                                        //
                                        //$(".item-list").prepend("<td><select ></select></td>");
                                        $(".item-list tbody tr[class^='list']").each(function(index,item){

                                           
                                            var options = data.CategoryList.map(function(x,idx){
                                                if(typeof localJSON.Data.category[index] !== "undefined")
                                                {
                                                    
                                                    /*
                                                    if(typeof localJSON.Data.category[index] === 'undefined') {
                                                        // does not exist
                                                    }*/
                                                    if(localJSON.Data.category[index].CategoryId == x.CategoryID )
                                                    {
                                                        //count++;
                                                        console.log("cat"+x.CategoryID);
                                                        return "<option selected='selected' value='"+x.CategoryID+"'>"+x.Name+"</option>";
                                                    }
                                                    else{

                                                        return "<option value='"+x.CategoryID+"'>"+x.Name+"</option>";
                                                    }
                                                }
                                                else{
                                                    return "<option value='"+x.CategoryID+"'>"+x.Name+"</option>";
                                                }
                                                
                                            }).join("");
                                            
                                            $(item).prepend("<td><select class='form-control cat' name='category"+index+"' id='category"+index+"'><option value='none'>SELECT</option>"+options+"</select></td>");

                                            if(localJSON.Data.category[index] !== void 0 && localJSON.Data.category.length -1 >= 0 ){
                                                //console.log(localJSON.Data.category[index].Price);

                                                $(".item-list #"+index+" #namedes"+index).val(localJSON.Data.category[index].ItemName+" - "+localJSON.Data.category[index].ItemDescription);
                                                $(".item-list #"+index+" #namedes-id"+index).val(localJSON.Data.category[index].ProductId);


                                                /*
                                                $.post("getProductList",{CategoryID:localJSON.Data.category[index].CategoryId},function(data,status){



                                                    var soptions = data.products.map(function(x,idx){
                                                        if(typeof localJSON.Data.category[index] !== 'undefined'){
                                                            if(localJSON.Data.category[index].ItemName == x.ItemName )
                                                            {
                                                                return "<option selected='selected' value='"+x.ProductId+"'>"+x.ItemName+" - "+x.ItemDescription+"</option>";
                                                            }
                                                            else{
                                                                return "<option value='"+x.ProductId+"'>"+x.ItemName+" - "+x.ItemDescription+"</option>";
                                                            }
                                                        }
                                                        else{
                                                            return "<option value='"+x.ProductId+"'>"+x.ItemName+" - "+x.ItemDescription+"</option>";
                                                        }
                                                    }).join("");
                                                   // $(".item-list #"+index+" #namedes"+index).append(soptions);
                                                });
*/
                                                
                                                /*$(".item-list #"+index+" #price"+index).val(localJSON.Data.category[index].Price);
                                                $(".item-list #"+index+" #uom"+index).val(localJSON.Data.category[index].UOM);
                                                $(".item-list #"+index+" #hsncode"+index).val(localJSON.Data.category[index].HSNCode);
                                                $(".item-list #"+index+" #igst"+index).val(localJSON.Data.category[index].IGST);
                                                $(".item-list #"+index+" #cgst"+index).val(localJSON.Data.category[index].CGST);
                                                $(".item-list #"+index+" #sgst"+index).val(localJSON.Data.category[index].SGST);*/

                                            }

                                       });
                                      
                                    });

                                    $("#addItem").click(function(){
                                       
                                       
                                           var noption = CatList.map(function(x,idx){
                                       
                                               return "<option value='"+x.CategoryID+"'>"+x.Name+"</option>";
                                            
                                           }).join("");
                                           var index = parseInt($(".item-list tbody tr:last").attr("id"));
                                           if (isNaN(index)) {
                                               index = -1;
                                           }
                                           index++;


                                           $(".item-list tbody").append("<tr class='list' id='" + index + "'><td><select class='form-control cat' name='category" + index + "' id='category" + index + "'><option value='none'>SELECT</option>" + noption + "</select></td><td><input type='hidden' name='update" + index + "' id='update" + index + "' value='insert' /><input type='hidden' id='itemName" + index + "' name='itemName" + index + "' value='' /><input class='form-control name-des' id='namedes" + index + "' name='namedes" + index + "' /><span>Item Name can't be empty</span><input type='hidden' name='namedes-id" + index + "' id='namedes-id" + index + "' ></td><td><input class='form-control' type='text' id='uom" + index + "' name='uom" + index + "'></td><td><input class='form-control' type='text' id='hsncode" + index + "' name='hsncode" + index + "'></td><td><input class='form-control calculate' type='text' id='price" + index + "' name='price" + index + "'><span>Price can't be empty</span></td><td><input name='qty" + index + "' class='form-control calculate' id='qty" + index + "' type='text'><span>Qty Name can't be empty</span></td><td><input class='form-control' readonly='readonly' type='text' id='amount" + index + "' name='amount" + index + "'></td><td><input class='form-control calculate' type='text' id='igst" + index + "' name='igst" + index + "'><span>IGST can't be empty</span></td><td><input class='form-control' readonly='readonly' type='text' id='igstamount" + index + "' name='igstamount" + index + "'></td><td><input class='form-control calculate' type='text' name='sgst" + index + "' id='sgst" + index + "'><span>SGST can't be empty</span></td><td><input class='form-control' readonly='readonly' type='text' id='sgstamount" + index + "' name='sgstamount" + index + "'></td><td><input class='form-control calculate' type='text' id='cgst" + index + "' name='cgst" + index + "'><span>CGST can't be empty</span></td><td><input class='form-control' readonly='readonly' type='text' id='cgstamount" + index + "' name='cgstamount" + index + "' ></td><td><input class='form-control' readonly='readonly' type='text' id='total" + index + "' name='total" + index + "'></td><td><input class='grn-enabled' type='checkbox' value='true' id='grnenable" + index + "' name='grnenable" + index + "'>GRN Enabled</td><td><button type='button' id='delete" + index + "' class='delete btn btn-primary'>DELETE</button></td>");

                                    });
                                    $('#invoceupdateform').submit(function() {
                                        if(ItemNameVal())
                                        {
                                            debugger;
                                            if($(".item-list tbody").children().length > 0)
                                            {

                                                return true;
                                            }
                                            else{
                                                alert("No Items");
                                                return false;
                                            }
                                        }
                                        else{
                                            return false;
                                        }
                                    })
                                    function ItemNameVal() {
                                        debugger;
                                        var led = [];
                                        var pricea=[];
                                        var qtya = [];
                                        var igsta = [];
                                        var cgsta = [];
                                        var sgsta = [];
                                        $(".item-list tbody tr.list").each(function(idx,ele){//.name-des-error-input
                                            var ledger = $("#namedes"+idx).val();
                                            var price = $("#price"+idx).val();
                                            var qty = $("#qty"+idx).val();
                                            var igst = $("#igst"+idx).val();
                                            var sgst = $("#sgst"+idx).val();
                                            var cgst = $("#cgst"+idx).val();
                                            console.log("led"+ledger);
                                            if(ledger == ""){
                                                $("#namedes"+idx+" +span").addClass("name-des-error");
                                                $("#namedes"+idx).addClass("name-des-error-input");

                                                //return false;
                                            }
                                            else {
                                                $("#namedes" + idx + " + span").removeClass("name-des-error");
                                                $("#namedes" + idx).removeClass("name-des-error-input");
                                            }
                                            if(price == ""){
                                                $("#price"+idx+" +span").addClass("name-des-error");
                                                $("#price"+idx).addClass("name-des-error-input");
                                            }
                                            else{
                                                $("#price"+idx+" + span").removeClass("name-des-error");
                                                $("#price"+idx).removeClass("name-des-error-input");
                                            }
                                            if(qty == ""){
                                                $("#qty"+idx+" +span").addClass("name-des-error");
                                                $("#qty"+idx).addClass("name-des-error-input");
                                            }
                                            else{
                                                $("#qty"+idx+" + span").removeClass("name-des-error");
                                                $("#qty"+idx).removeClass("name-des-error-input");
                                            }
                                            if(sgst == ""){
                                                $("#sgst"+idx+" +span").addClass("name-des-error");
                                                $("#sgst"+idx).addClass("name-des-error-input");
                                            }
                                            else{
                                                $("#sgst"+idx+" + span").removeClass("name-des-error");
                                                $("#sgst"+idx).removeClass("name-des-error-input");
                                                if(!ValGST("sgst"+idx)){
                                                    $("#sgst"+idx+" +span").addClass("name-des-error");
                                                    $("#sgst"+idx+" +span").text("Not a Valid Number");
                                                    $("#sgst"+idx).addClass("name-des-error-input");
                                                }
                                                else{
                                                    $("#sgst"+idx+" +span").removeClass("name-des-error");
                                                    $("#sgst"+idx+" +span").text("Item Name can't be empty");
                                                    $("#sgst"+idx).removeClass("name-des-error-input");
                                                }
                                                
                                            }
                                            if(igst == ""){
                                                $("#igst"+idx+" +span").addClass("name-des-error");
                                                $("#igst"+idx).addClass("name-des-error-input");
                                            }
                                            else{
                                                $("#igst"+idx+" + span").removeClass("name-des-error");
                                                $("#igst"+idx).removeClass("name-des-error-input");
                                                if(!ValGST("igst"+idx)){
                                                    $("#igst"+idx+" +span").addClass("name-des-error");
                                                    $("#igst"+idx+" +span").text("Not a Valid Number");
                                                    $("#igst"+idx).addClass("name-des-error-input");
                                                }
                                                else{
                                                    $("#igst"+idx+" +span").removeClass("name-des-error");
                                                    $("#igst"+idx+" +span").text("Item Name can't be empty");
                                                    $("#igst"+idx).removeClass("name-des-error-input");
                                                }
                                            }
                                            if(cgst == ""){
                                                $("#cgst"+idx+" +span").addClass("name-des-error");
                                                $("#cgst"+idx).addClass("name-des-error-input");
                                            }
                                            else{
                                                $("#cgst"+idx+" + span").removeClass("name-des-error");
                                                $("#cgst"+idx).removeClass("name-des-error-input");
                                                if(!ValGST("cgst"+idx)){
                                                    $("#cgst"+idx+" +span").addClass("name-des-error");
                                                    $("#cgst"+idx+" +span").text("Not a Valid Number");
                                                    $("#cgst"+idx).addClass("name-des-error-input");
                                                }
                                                else{
                                                    $("#cgst"+idx+" +span").removeClass("name-des-error");
                                                    $("#cgst"+idx+" +span").text("Item Name can't be empty");
                                                    $("#cgst"+idx).removeClass("name-des-error-input");
                                                }
                                            }
                                            var ledger = $("#namedes"+idx).val();
                                            @*var invoiceid = @Model.InvoiceID;*@

                                            if(ledger != "") {
                                                var ledgerobj = { LedgerName: ledger };
                                                led.push(ledgerobj);
                                            }
                                            if(price != ""){
                                                var ledgerobj = { Price:price};
                                                pricea.push(ledgerobj);
                                            }
                                            if(qty != ""){
                                                var ledgerobj = { Qty:qty};
                                                qtya.push(ledgerobj);
                                            }
                                            if(sgst != "" && ValGST("sgst"+idx)){
                                                var ledgerobj = { SGST:sgst};
                                                sgsta.push(ledgerobj);
                                            }
                                            if(igst != "" && ValGST("igst"+idx)){
                                                var ledgerobj = { IGST:igst};
                                                igsta.push(ledgerobj);
                                            }
                                            if(cgst != "" && ValGST("cgst"+idx)){
                                                var ledgerobj = { IGST:cgst};
                                                cgsta.push(ledgerobj);
                                            }
                                        });
                                        var rowlen = $(".item-list tbody tr.list").length;
                                        if(rowlen == led.length && rowlen == pricea.length && rowlen == qtya.length && rowlen == sgsta.length && rowlen == cgsta.length && rowlen == igsta.length){
                                            return true;

                                        }
                                        else {
                                            return false;
                                        }
                                    }
                                    $(".item-list tbody").on("propertychange change input paste",".name-des ,.calculate",function(){
                                        
                                        var id = $(this).attr("id");
                                        var eleArray = ["sgst","igst","cgst"];
                                        var nid = id.substring(0,4);
                                        if(eleArray.includes(nid))
                                        {
                                        
                                            if(ValGST(id) == false){
                                                
                                                $("#" + id).addClass("name-des-error-input");
                                                $("#" + id + " +span").text("Not a Valid Number");
                                                $("#" + id + " +span").addClass("name-des-error");
                                            }
                                            else{
                                                
                                                $("#" + id).removeClass("name-des-error-input");
                                                $("#" + id + " +span").text("Item Name can't be empty");
                                                $("#" + id + " +span").removeClass("name-des-error");
                                            }
                                        }
                                        else{
                                        if($("#"+id).val() != "")
                                        {
                                            $("#"+id).removeClass("name-des-error-input");
                                            $("#"+id + " +span").removeClass("name-des-error");
                                        }
                                        else {
                                            $("#" + id).addClass("name-des-error-input");
                                            $("#" + id + " +span").addClass("name-des-error");
                                        }
                                        }
                                    });
                                    function ValGST(id){
                                        var valArray = ["0.00","2.50" ,"5.00", "6.00", "9.00","12.00","14.00" ,"18.00","28.00"];
                                        var boxvalue = parseFloat($("#"+id).val()).toFixed(2);
                                        var truth = valArray.includes(boxvalue.toString());
                                        
                                        return truth;

                                        
                                    }
                                    $('.item-list').on('input propertychange paste',".calculate", function() {
                                        var id = $(this).attr("id").replace( /^\D+/g, '');

                                        var sgst = $(".item-list #"+id+" #sgst"+id).val();
                                        var cgst = $(".item-list #"+id+" #cgst"+id).val();
                                        var igst = $(".item-list #"+id+" #igst"+id).val();
                                       // console.log(cgst);
                                        var qty = $(".item-list #"+id+" #qty"+id).val();
                                        var price = $(".item-list #"+id+" #price"+id).val();
                                        var iamount = parseFloat(( price * qty * igst)/100).toFixed(2);
                                        //console.log("iam"+iamount);
                                        $(".item-list #"+id+" #igstamount"+id).val(iamount)
                                        var samount = parseFloat((price * qty * sgst)/100).toFixed(2);
                                        //console.log("sam"+samount);
                                        $(".item-list #"+id+" #sgstamount"+id).val(samount);
                                        var camount = parseFloat((price * qty * cgst)/100).toFixed(2);
                                        //console.log("cam"+camount);
                                        var amount = parseFloat(price * qty).toFixed(2);
                                        $(".item-list #"+id+" #cgstamount"+id).val(camount);
                                        var total = (parseFloat(amount) + parseFloat(iamount) + parseFloat(samount) + parseFloat(camount)).toFixed(2);
                                        $(".item-list #"+id+" #total"+id).val(total);
                                        $(".item-list #" + id + " #amount" + id).val(amount);
                                        
                                        var finaltotal = 0.00;
                                        $(".item-list tbody tr[class^='list']").each(function(index,item){
                                            var id = $(item).attr("id");
                                            var tot = $("#amount"+id).val();
                                            
                                            if (tot.length > 0)
                                            {
                                                finaltotal = finaltotal + parseFloat(tot);
                                            }
                                        });
                                        $("#InvoiceAmount").val(finaltotal);

                                        // do your stuff
                                    });
                                    $('.item-list').on('input propertychange paste',".grncal", function() {
                                        var id = $(this).attr("id").replace( /^\D+/g, '');

                                        var sgst = $(".item-list #grn"+id+" #grnsgst"+id).val();
                                        var cgst = $(".item-list #grn"+id+" #grncgst"+id).val();
                                        var igst = $(".item-list #grn"+id+" #grnigst"+id).val();
                                        //console.log(cgst);
                                        var qty = $(".item-list #grn"+id+" #grnqty"+id).val();
                                        var price = $(".item-list #grn"+id+" #grnprice"+id).val();
                                        var iamount = parseFloat(( price * qty * igst)/100).toFixed(2);
                                        //console.log("iam"+iamount);
                                        $(".item-list #grn"+id+" #grnigstamount"+id).val(iamount)
                                        var samount = parseFloat((price * qty * sgst)/100).toFixed(2);
                                        //console.log("sam"+samount);
                                        $(".item-list #grn"+id+" #grnsgstamount"+id).val(samount);
                                        var camount = parseFloat((price * qty * cgst)/100).toFixed(2);
                                        //console.log("cam"+camount);
                                        var amount = parseFloat(price * qty).toFixed(2);
                                        $(".item-list #grn"+id+" #grncgstamount"+id).val(camount);
                                        var total = (parseFloat(amount) + parseFloat(iamount) + parseFloat(samount) + parseFloat(camount)).toFixed(2);
                                        $(".item-list #grn"+id+" #grntotal"+id).val(total);
                                        $(".item-list #grn" + id + " #grnamount" + id).val(amount);


                                        // do your stuff
                                    });

                                    
                                    $(".item-list").on("change",".grn-enabled",function() {
                                            if(this.checked) {
                                                //Do stuff
                                                
                                                var id = $(this).attr("id").replace( /^\D+/g, '');
                                                console.log("checked"+id);
                                                var grnprice = $(".item-list #"+id+" td:nth-child(5) input").val();
                                                var grnqty = $(".item-list #"+id+" td:nth-child(6) input").val();
                                                
                                                var grnamount = $(".item-list #"+id+" td:nth-child(7) input").val();
                                                
                                                var grnigst = $(".item-list #"+id+" td:nth-child(8) input").val();
                                                
                                                var grniamount = $(".item-list #"+id+" td:nth-child(9) input").val();
                                                
                                                var grnsgst = $(".item-list #"+id+" td:nth-child(10) input").val();
                                                
                                                var grnsamount = $(".item-list #"+id+" td:nth-child(11) input").val();
                                                
                                                var grncgst = $(".item-list #"+id+" td:nth-child(12) input").val();
                                                
                                                var grncamount = $(".item-list #"+id+" td:nth-child(13) input").val();
                                                
                                                var grntotal = $(".item-list #"+id+" td:nth-child(14) input").val();
                                                
                                                $(".item-list #"+id).after("<tr id='grn"+id+"' ><td></td><td></td><td></td><td></td><td><input name='grnprice"+id+"' value='"+grnprice+"' class='form-control grncal valid' id='grnprice"+id+"' type='text' /></td><td><input name='grnqty"+id+"' value='"+grnqty+"' class='form-control grncal valid' id='grnqty"+id+"' type='text' /></td><td><input name='grnamount"+id+"' value='"+grnamount+"' class='form-control valid' id='grnamount"+id+"' type='text' /></td><td><input name='grnigst"+id+"' value='"+grnigst+"' class='form-control grncal valid' id='grnigst"+id+"' type='text' /></td><td><input name='grnigstamount"+id+"' readonly='readonly' value='"+grniamount+"' class='form-control valid' id='grnigstamount"+id+"' type='text' /></td><td><input name='grnsgst"+id+"' value='"+grnsgst+"' class='form-control grncal valid' id='grnsgst"+id+"' type='text' /></td><td><input name='grnsgstamount"+id+"' value='"+grnsamount+"' readonly='readonly' class='form-control valid' id='grnsgstamount"+id+"' type='text' /></td><td><input name='grncgst"+id+"' value='"+grncgst+"' class='form-control grncal valid' id='grncgst"+id+"' type='text' /></td><td><input name='grncgstamount"+id+"' readonly='readonly' value='"+grncamount+"' class='form-control valid' id='grncgstamount"+id+"' type='text' /></td><td><input name='grntotal"+id+"' readonly='readonly' class='form-control valid' id='grntotal"+id+"' value='"+grntotal+"' type='text' /></td></tr>");

                                            }
                                            else{
                                                var id = $(this).attr("id").replace( /^\D+/g, '');
                                                $("#grn"+id).remove();
                                            }
                                        });

                                    $(".item-list").on("change","select.cat",function(){
                                        //var id = $(this).attr("id").substr(8,2);
                                        var id = $(this).attr("id").replace( /^\D+/g, '');
                                        var CategoryID = this.value;

                                        $.post("getProductList",{CategoryID},function(data,status){

                                            //$(".item-list tr#"+id+" .dynamic").remove();
                                           // $(".item-list tr#"+id+" .product-item").remove();

                                            /*
                                            if($(".item-list tr#"+id).hasClass("cat"))
                                            {
                                                $(".item-list tr#"+id+" .cat").remove();
                                            }
                                            */
                                            //console.log(data);
/*
                                            var soptions = data.products.map(function(x,idx){
                                                return "<option value='"+x.ProductId+"'>"+x.ItemName+" - "+x.ItemDescription+"</option>";
                                            }).join("");*/

                                           // $(".item-list #"+id+" #namedes"+id).append(soptions);


                                            $(".item-list #"+id+" #namedes"+id).val("");
                                            $(".item-list #"+id+" #namedes-id"+id).val("");
                                            $(".item-list #"+id+" #name"+id).val("");
                                            var soptions = data.products.map(function(x,idx){
                                             
                                                return {id:x.ProductId,value:x.ItemName+" - "+x.ItemDescription};
                                            
                                            });
                                            
                                           
                                           
                                            $(".item-list #"+id+" #namedes"+id).autocomplete({
                                                source: soptions,
                                                response: function (event, ui) {
                                                    if (!ui.content.length) {
                                                        var noResult = { value: "", label: "No Items matching your request" };
                                                        ui.content.push(noResult);
                                                    }
                                                },
                                                select: function (event, ui) {
                                                    
                                                    $(".item-list #"+id+" #namedes"+id).val(ui.item.value);
                                                    $(".item-list #"+id+" #namedes-id"+id).val(ui.item.id);
                                                   
                                                    //$(".item-list #"+id+" #namedes-id"+id).after("<input type='hidden' id='itemName"+id+"' name='itemName"+id+"' />");

                                                   
                                                    
                                                    
                                                    var name = $(".item-list #"+id+" #namedes"+id).val().split("-")[0].trim();
                                                    
                                                   //$(".item-list #"+id+" #name"+id).val("sankalp");
                                                    $("#itemName"+id).val(name);
                                                   
                                                   
                                                   
                                                    var productId = ui.item.id;

                                        $.post("getInvoiceItem",{productId},function(data,status){
                                            //console.log(data);
                                            $(".item-list #"+id+" #price"+id).val(data.dbitem.Price);
                                            $(".item-list #"+id+" #uom"+id).val(data.dbitem.UOM);
                                            $(".item-list #"+id+" #hsncode"+id).val(data.dbitem.HSN);
                                            $(".item-list #"+id+" #igst"+id).val(data.dbitem.IGST);
                                            $(".item-list #"+id+" #cgst"+id).val(data.dbitem.CGST);
                                            $(".item-list #"+id+" #sgst"+id).val(data.dbitem.SGST);
                                            $(".item-list #"+id+" #amount"+id).val(data.dbitem.Amount);

                                            if(!isNaN(data.dbitem.Price) && !isNaN(data.dbitem.IGST) && !isNaN(data.dbitem.SGST) && !isNaN(data.dbitem.CGST))
                                            {
                                                var qty = $(".item-list #"+id+" #qty"+id).val();
                                                var iamount = parseFloat((data.dbitem.Price * qty * data.dbitem.IGST)/100).toFixed(2);
                                                //console.log("iam"+iamount);
                                                $(".item-list #"+id+" #igstamount"+id).val(iamount)
                                                var samount = parseFloat((data.dbitem.Price * qty * data.dbitem.SGST)/100).toFixed(2);
                                               // console.log("sam"+samount);
                                                $(".item-list #"+id+" #sgstamount"+id).val(samount);
                                                var camount = parseFloat((data.dbitem.Price * qty * data.dbitem.CGST)/100).toFixed(2);
                                                //console.log("cam"+camount);
                                                $(".item-list #" + id + " #cgstamount" + id).val(camount);
                                                var amount = parseFloat(data.dbitem.Price * qty).toFixed(2);
                                                var total = (parseFloat(amount) + parseFloat(iamount) + parseFloat(samount) + parseFloat(camount)).toFixed(2);
                                                $(".item-list #"+id+" #total"+id).val(total);
                                                $(".item-list #" + id + " #amount" + id).val(amount);
                                                var finaltotal = 0.00;
                                                $(".item-list tbody tr[class^='list']").each(function(index,item){
                                                    var id = $(item).attr("id");
                                                    var tot = $("#amount"+id).val();
                                            
                                                    if (tot.length > 0)
                                                    {
                                                        finaltotal = finaltotal + parseFloat(tot);
                                                    }
                                                });
                                                $("#InvoiceAmount").val(finaltotal);
                                                ItemNameVal();
                                            }

                                                        //$(".item-list #"+id +" td:last").before("<td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='description"+id+"' value='"+data.dbitem.Description+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='price"+id+"' value='"+data.dbitem.Price+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='uom"+id+"' value='"+data.dbitem.UOM+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='hsn"+id+"' value='"+data.dbitem.HSN+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='sgst"+id+"' value='"+data.dbitem.SGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='cgst"+id+"' value='"+data.dbitem.CGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='igst"+id+"' value='"+data.dbitem.IGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='igst"+id+"' value='"+data.dbitem.Amount+"' /></td>");
                                                    });
                                                },
                                                minLength: 1
                                            });

                                            



                                            $(".item-list #"+id+" #namedes"+id).empty();
                                            $(".item-list #"+id+" #price"+id).val();
                                            $(".item-list #"+id+" #uom"+id).val();
                                            $(".item-list #"+id+" #hsncode"+id).val();
                                            $(".item-list #"+id+" #igst"+id).val();
                                            $(".item-list #"+id+" #cgst"+id).val();
                                            $(".item-list #"+id+" #sgst"+id).val();
                                            $(".item-list #"+id+" #amount"+id).val();
                                            //$(".item-list #"+id+" #namedes"+id).append("<option value='none'>SELECT ITEM</option>");
                                            //$(".item-list #"+id+" #namedes"+id).append(soptions);
                                            //$(".item-list #"+id +" td:last").before("<td class='product-item'><select class='form-control product-item' id='name"+id+"'><option value='none'>SELECT ITEM</option>"+soptions+"</select></td>");
                                        });

                                    });

                                    $(".item-list").on("change",".name-des",function(){

                                        //var id = $(this).attr("id").substr(7,2);
                                        var id = $(this).attr("id").replace( /^\D+/g, '');
                                        //$(".item-list tr#"+id+" #name-des"+id).remove();
                                        var name = $("#namedes"+id+" option:selected").text().split("-")[0].trim();
                                        $("#name"+id).val(name);
                                        var productId = this.value;

                                        /*
                                        $.post("getInvoiceItem",{productId},function(data,status){
                                            console.log(data);
                                            $(".item-list #"+id+" #price"+id).val(data.dbitem.Price);
                                            $(".item-list #"+id+" #uom"+id).val(data.dbitem.UOM);
                                            $(".item-list #"+id+" #hsncode"+id).val(data.dbitem.HSN);
                                            $(".item-list #"+id+" #igst"+id).val(data.dbitem.IGST);
                                            $(".item-list #"+id+" #cgst"+id).val(data.dbitem.CGST);
                                            $(".item-list #"+id+" #sgst"+id).val(data.dbitem.SGST);
                                            $(".item-list #"+id+" #amount"+id).val(data.dbitem.Amount);

                                            if(!isNaN(data.dbitem.Price) && !isNaN(data.dbitem.IGST) && !isNaN(data.dbitem.SGST) && !isNaN(data.dbitem.CGST))
                                            {
                                                var qty = $(".item-list #"+id+" #qty"+id).val();
                                                var iamount = parseFloat((data.dbitem.Price * qty * data.dbitem.IGST)/100).toFixed(2);
                                                //console.log("iam"+iamount);
                                                $(".item-list #"+id+" #igstamount"+id).val(iamount)
                                                var samount = parseFloat((data.dbitem.Price * qty * data.dbitem.SGST)/100).toFixed(2);
                                               // console.log("sam"+samount);
                                                $(".item-list #"+id+" #sgstamount"+id).val(samount);
                                                var camount = parseFloat((data.dbitem.Price * qty * data.dbitem.CGST)/100).toFixed(2);
                                                //console.log("cam"+camount);
                                                $(".item-list #"+id+" #cgstamount"+id).val(camount);
                                                var total = (parseFloat(data.dbitem.Price * qty) + parseFloat(iamount) + parseFloat(samount) + parseFloat(camount)).toFixed(2);
                                                $(".item-list #"+id+" #total"+id).val(total);
                                                $(".item-list #"+id+" #amount"+id).val(data.dbitem.Price * qty);
                                            }

                                            //$(".item-list #"+id +" td:last").before("<td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='description"+id+"' value='"+data.dbitem.Description+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='price"+id+"' value='"+data.dbitem.Price+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='uom"+id+"' value='"+data.dbitem.UOM+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='hsn"+id+"' value='"+data.dbitem.HSN+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='sgst"+id+"' value='"+data.dbitem.SGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='cgst"+id+"' value='"+data.dbitem.CGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='igst"+id+"' value='"+data.dbitem.IGST+"' /></td><td class='dynamic'><input id='"+id+"' type='text' class='form-control' id='igst"+id+"' value='"+data.dbitem.Amount+"' /></td>");
                                        });*/

                                    });
                                   
                                   
                                    
                                    

                               
                                }); 

                            </script>
                            @if(ViewBag.ERP == true) {
                            <script>
                                $(function(){
                                
                                    var ledgerdata = @Html.Raw(ViewBag.LedgerNames);

                                    var ledgerdb = ledgerdata.Data.ledgerlist;
                                    var options = ledgerdb.map(function(x,idx){

                                        return {id:idx,value:x.Value};

                                    });
                                    
                                    $("#ledgerlist").autocomplete({
                                        source: options,
                                        response: function (event, ui) {
                                            if (!ui.content.length) {
                                                var noResult = { value: "", label: "No Items matching your request" };
                                                ui.content.push(noResult);
                                            }
                                        },
                                        select: function (event, ui) {


                                        }
                                    ,
                                        minLength: 1
                                    });
                                
                                });
                            </script>
                            }
                            <div class="col-sm-12 col-md-12" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                    <div class="panel-heading">
                                        <span class="widget-icon"> <i class="fa-lg fa fa-table"></i> </span>
                                        <b>DEBIT NOTE</b>
                                    </div>
                                    <div class="panel-body">
                                        <div id="divDataCredit">
                                            <table id="divnotes" class="table-striped table-bordered table-hover table-condensed" style="width:100%;">
                                                <tr id="notesrow" class="item">
                                                    <td align="center">
                                                        <input type="button" id="btnGenerate" class="btn btn-primary button2" value="GENERATE CREDIT/DEBIT NOTE" onclick="generateCrDrNote()" />
                                                        @*<input type="submit" id="btnAdd" class="btn btn-default button2" value="Add" onclick="return myFunction()" />*@
                                                    </td>
                                                    <td>
                                                        Generated Credit/Debit Notes
                                                    </td>
                                                    <!--<td>
                                                        <table id="divnoteslist" class="table-striped table-bordered table-hover table-condensed" style="width:100%;">
                                                            <tr>
                                                                <td></td>
                                                            </tr>
                                                        </table>
                                                    </td>-->
                                                    @if (Model.CreditDebitNotes != null)
                                                    {
                                                        for (int i = 0; i < Model.CreditDebitNotes.Count; i++)
                                                        {
                                                            <td style="font-weight:bold;"><a class="noteslink" href="CreditView?Id=@Html.DisplayFor(m => m.CreditDebitNotes[i].CrDrNoteID)">@Html.DisplayFor(m => m.CreditDebitNotes[i].NoteType)&nbsp;Note</a></td>
                                                        }
                                                    }
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                <div class="col-sm-12 col-md-12" style="background-color:white">
                                    <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                        <div class="panel-heading">
                                            <span class="widget-icon"> <i class="fa-lg fa fa-pencil-square-o"></i></span>
                                            <b>APPROVAL HISTORY</b>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-inline" role="form">
                                                <div align="center" id="cmnt" style="border: thin inset;">

                                                    <table id="divcomments" class="table-striped table-bordered table-hover table-condensed" style="width:100% ">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                            </tr>

                                                        </thead>

                                                    </table>
                                                </div>

                                                <div id="labelfinaladetails" style="display:none;border: thin inset ">

                                                    <fieldset>
                                                        <div class="row">
                                                            <section>
                                                                <table style="border-collapse:separate; border-spacing:16px; width:88%" align="left" class="table-bordered table-hover ">
                                                                    <tr>
                                                                        <td align="right">
                                                                            <section class="col col-4">
                                                                                <label class="input">
                                                                                    Navision Voucher No :
                                                                                </label>

                                                                            </section>
                                                                        </td>
                                                                        <td align="left">
                                                                            <section class="col col-4">
                                                                                <label class="input" id="lblNavisionVoucherno">
                                                                                    @*@Html.TextBoxFor(m => m.Navisionvoucherno, new { placeholder = "Navision Voucher ", @class = "final", id = "txtNavisionVoucherno" })*@
                                                                                    @Html.ValidationMessageFor(m => m.InvoiceAmount)
                                                                                </label>

                                                                            </section>
                                                                        </td>

                                                                    </tr>
                                                                </table>
                                                            </section>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>


                                @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 2 || int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3)*@
                                @if (true)
                                {
                                    <div class="col-sm-12 col-md-12" style="background-color:white">
                                        <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                            <div class="panel-heading">
                                                <span class="widget-icon"> <i class=" fa-lg fa fa-table"></i> </span>
                                                <b>VENDOR RATING</b>
                                            </div>
                                            <div class="panel-body">
                                                <div class="form-inline" role="form">
                                                    <div class="widget-body">
                                                        <div class="input-group" style="width:100%">
                                                            <div id="divRating" class="col-sm-12" style="width:100%">
                                                                <table style="border-collapse:separate; border-spacing:16px; width:80%" align="left" class="table-bordered table-condensed table-hover">
                                                                    <tr>
                                                                        @if (ViewBag.VendorRating == "Edit")
                                                                        {
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 1, new { id = "radioRating1" })
                                                                                    <i></i>1 (Excellent)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 2, new { id = "radioRating2" })
                                                                                    <i></i>2 (Very Good)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 3, new { id = "radioRating3" })
                                                                                    <i></i>3 (Good)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 4, new { id = "radioRating4" })
                                                                                    <i></i>4 (Average)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 5, new { id = "radioRating5" })
                                                                                    <i></i>5 (Below Average)
                                                                                </label>
                                                                            </td>
                                                                        }
                                                                        else
                                                                        {
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.LabelFor(x => x.Rating)

                                                                                </label>

                                                                            </td>

                                                                            <td> @Html.DisplayFor(x => x.Rating) </td>
                                                                            <td>@Html.HiddenFor(x => x.Rating)</td>
                                                                        }
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                            <br />

                                                            <div id="divComment" align="left" class="col-sm-12" style="width:100%">
                                                                @Html.TextAreaFor(m => m.VendorComment, new { placeholder = "Your comment here...", id = "txtComment", @rows = 4, @class = "form-control", @style = "width:80%" })
                                                                @Html.ValidationMessageFor(m => m.VendorComment)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }

                                @*=========================================================================================*@
                                <div class="col-sm-12 col-md-12">
                                    <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                        <div class="panel-heading">
                                            <span class="widget-icon"> <i class="fa-lg fa fa-table"></i> </span>
                                            <b>ACTION ON INVOICE</b>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-inline" role="form">
                                                <div class="widget-body">
                                                    <div class="input-group" style="width:100%">
                                                        <div align="left" class="col-sm-12" style="width:100%" id="curentcoment">
                                                            @Html.TextAreaFor(m => m.Comment, new { placeholder = "Comment", id = "txtcomment", @cols = 20, @rows = 4, @class = "form-control", @style = "width:80%" })
                                                            @Html.ValidationMessageFor(m => m.Comment)
                                                        </div>
                                                    </div>
                                                    <div id="invoicepermissions" style="border: thin inset ; margin-top:1%">
                                                        <fieldset>
                                                            <div>
                                                                <section>
                                                                    <table style="border-collapse:separate; border-spacing:16px; width:80%" align="left" class="table-bordered table-condensed table-hover">
                                                                        <tr>


                                                                            @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 1 && Model.WFStatus == 300 )
                                                        {*@
                                                                            @*<td id="rdrecommend">
                                                            <label class="checkbox" style="margin-left:10%" id="chkAdmin">

                                                                @Html.RadioButtonFor(x => x.status, "A", new { @class = "reassign", id = "Recommend" })

                                                                <i></i>Recommend For payment
                                                            </label>
                                                        </td>*@
                                                                            @*}
                                                        else
                                                        {*@
                                                                            <td id="rdapprove">
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">

                                                                                    @Html.RadioButtonFor(x => x.status, "A", new { @class = "reassign", id = "radioApprove" })
                                                                                    @Html.ValidationMessageFor(m => m.status)
                                                                                    <i></i>Approve

                                                                                </label>

                                                                            </td>
                                                                            @*}*@
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                                                    @Html.RadioButtonFor(x => x.status, "R", new { @class = "reassign", id = "idReject" })
                                                                                    <i></i>Reject
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                                                    @Html.RadioButtonFor(x => x.status, "H", new { @class = "reassign", id = "idHold" })
                                                                                    <i></i>Hold
                                                                                </label>
                                                                            </td>

                                                                            @*@if ((int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 2) || (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3))
                                                        {*@
                                                                            <!--
                                                    <td id="reassignradio">
                                                        <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                            @Html.RadioButtonFor(x => x.status, "ReAssign", new { @class = "reassign", id = "reassign" })
                                                            <i></i>ReAssign
                                                        </label>
                                                    </td>-->
                                                                            @*}*@

                                                                            @* Added If condition as per new change request *@
                                                                            @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3)
                                                        {*@
                                                                            <td style="display:none" id="reassigntd">
                                                                                <label class="select">
                                                                                    @Html.DropDownList("ReAssignID", new SelectList(ViewBag.ReAssignUsers, "Value", "Text"), " ReAssign", new { id = "drpdwnreassign" })
                                                                                    @Html.ValidationMessage("ReAssignID")
                                                                                </label>
                                                                            </td>


                                                                            @*@for (int i = 0; i < Model.UserTypes.Count; i++)
                                                        {
                                                             <td id="VoucherTypes">
                                                            @Html.DropDownListFor(model => Model.UserTypes[i].SelectedUserId, new SelectList(Model.UserTypes[i].Users, "Value", "Text"))

                                                             </td>
                                                        }*@
                                                                        </tr>


                                                                    </table>
                                                                </section>
                                                            </div>
                                                        </fieldset>


                                                    </div>
                                                    <br />
                                                    <br />
                                                    @Html.Hidden("hdnId")

                                                    <div id="finaladetails" style="display:none;border: thin inset ">

                                                        <fieldset>
                                                            <div class="row">
                                                                <section>
                                                                    <table style="border-collapse:separate; border-spacing:16px; width:100%" align="center" class="table-bordered table-hover ">
                                                                        <tr>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Navision Voucher No :
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">

                                                                                        @Html.TextBoxFor(m => m.Navisionvoucherno, new { placeholder = "Navision Voucher ", @class = "final", id = "txtNavisionVoucherno" })
                                                                                        @Html.ValidationMessageFor(m => m.InvoiceAmount)
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Date of Payment :
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        @Html.TextBoxFor(m => m.DateOfPayment, new { placeholder = "Date of Payment", @class = "date final", id = "txtdateofpayment" })
                                                                                        @Html.ValidationMessageFor(m => m.DateOfPayment)
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Date of Account :
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        @Html.TextBoxFor(m => m.DateOfAccount, new { placeholder = "Date Of Account", @class = "date final", id = "txtDateOfAccount" })
                                                                                        @Html.ValidationMessageFor(m => m.DateOfAccount)
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </section>
                                                            </div>
                                                        </fieldset>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @*=========================================================================================*@


                            </div>
                           <div class="col-md-10">
                                <button class="btn btn-primary cmd " type="submit" id='cmdSubmit' style="margin-left:20px;">
                                    <i class="fa fa-save"></i>
                                    SUBMIT
                                </button>
                                <button class="btn btn-primary cmd" type="button" id='btnReassign' style="margin-left:8px; display:none">
                                    Re-Assign
                                </button>
                                <button class="btn btn-default cmd" type="button" id='cancelbtn' style="margin-left:8px">
                                    CANCEL
                                </button>
                            </div>
                    </div>
                </div>
                <!-- /.col-lg-6 -->
            </div>

        }

        <!--<button type="button" id="somebutton">SomeButton</button>-->
    </div>
}
else
{
    <style>
        .zoom-icon {
            position: absolute;
            bottom: 80px;
            left: 420px;
        }
    </style>
    <div class="wrapper" style="background-color:#FFFFFF;">
        @*@using (Html.BeginForm("SubmitInvoice", "Invoice",FormMethod.Post))*@
        @using (Html.BeginForm("UpdateInvoice", "Invoice", FormMethod.Post, new { id = "invoceupdateform", enctype = "multipart/form-data" }))
        {
            <div id="Inv">

                <div id="page-wrapper">
                    <div class="">
                        @*<div class="col-lg-12">
                                <h1 class="page-header">Invoice Reader</h1>
                            </div>*@
                        <!-- /.col-lg-12 -->
                    </div>
                    <!-- /.row -->

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="panel panel-info" style="margin-left:10px;margin-top:10px;">
                                <div class="panel-heading">
                                    <h5><b>INVOICE</b></h5>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body" style="padding-top:15px;padding-left:0;height: 648px;">
                                    <table>
                                        <tr>
                                            <td style="color:green">@Html.Raw(ViewBag.ErrMsg)</td>
                                        </tr>
                                    </table>
                                    <table id="icon-navbar" class="icon-navbar">
                                        <thead>
                                            <tr><td></td></tr>
                                        </thead>
                                    </table>
                                    <object id="object_id" style="float:right;" data='@Url.Action("GetFile", "Invoice", new { @filepath = Model.filePath })' width="500" height="600"></object>
                                    <div id="imgviewer">
                                        <img id="view" width="500" height="600" src="#" alt="Alternate Text" />
                                    </div>
                                    <div class="zoom-icon">
                                        <img id="plus" src="~/Content/images/plus.png" height="25" width="25" />
                                        <img id="minus" src="~/Content/images/minus.png" height="20" width="20" />
                                    </div>
                                    <br />
                                    <div style="height:62px;width:481px;float:right;">
                                        <span id="remove" class="glyphicon glyphicon-remove" style="float:left;font-size:30px;"></span>
                                        <input style="float: left;margin-left: 81px;margin-top: 6px;width: 100px;" type="file" name="UploadSupportFile" id="SupportFile" multiple="multiple" onchange="addToInvoiceImagesList();">
                                    </div>
                                </div>

                                <!-- .panel-body -->
                            </div>
                            <!-- /.panel -->
                        </div>
                        <!-- /.col-lg-6 -->
                        <div id="divInvoice">
                            <div class="col-sm-6 col-md-6" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;margin-top:10px;">
                                    <div class="panel-heading">
                                        <h5><b>VENDOR DETAILS</b></h5>
                                    </div>
                                    <!-- /.panel-heading -->
                                    <div class="panel-body">
                                        <table id="InvoiceInfo" class="display table table-bordered table-hover">
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.SecurityName)</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.SecurityName, new { @class = "form-control" })
                                                       
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.GateEntryNumber)</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.GateEntryNumber, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.GateEntryNumber)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Type</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.SelectedType, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.SelectedType)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.VehicleNumber)</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.VehicleNumber, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.VehicleNumber)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.Date)</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.Date, "{0:dd/MM/yyyy }", new { @class = "form-control date" })
                                                        
                                                        @Html.ValidationMessageFor(m => m.Date)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">@Html.DisplayNameFor(m => m.Time)</td>
                                                    <td>
                                                        @Html.DisplayFor(m => m.Time, new { @class = "form-control timepicker" })
                                                        @Html.ValidationMessageFor(m => m.Time)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">Invoice No.</td>
                                                    <td>
                                                        @Html.HiddenFor(m => m.InvoiceID)
                                                        @Html.DisplayFor(m => m.InvoiceNumber)
                                                        @Html.ValidationMessageFor(m => m.InvoiceNumber)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Amount</td>
                                                    <td id="lblInvoiceAmount">
                                                        @Html.DisplayFor(m => m.InvoiceAmount)
                                                        @Html.Hidden("hdnInvoiceAmount")
                                                        @Html.Hidden("hdnTotalAmount")
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Date</td>
                                                    <td>
                                                        @* @Html.DisplayFor(m => m.InvoiceDate, "{0:dd/MM/yyyy }") *@
                                                        @Model.InvoiceDate.Value.ToString("dd/MM/yyyy")
                                                       
                                                        @Html.ValidationMessageFor(m => m.InvoiceDate)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Received Date</td>
                                                    <td>
                                                        @* @Html.DisplayFor(m => m.InvoiceReceiveddate, "{0:dd/MM/yyyy }", new { @class = "form-control" }) *@
                                                        @Model.InvoiceReceiveddate.Value.ToString("dd/MM/yyyy")
                                                        @Html.ValidationMessageFor(m => m.InvoiceReceiveddate)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Due Date</td>
                                                    <td>
                                                        @* @Html.DisplayFor(m => m.InvoiceDueDate, "{0:dd/MM/yyyy }", new { @class = "form-control" }) *@
                                                        @Model.InvoiceDueDate.Value.ToString("dd/MM/yyyy")
                                                        @Html.ValidationMessageFor(m => m.InvoiceDueDate)
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">PO Number</td>
                                                    <td>@Html.DisplayFor(m => m.PONumber)</td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">PAN Number</td>
                                                    <td>@Html.DisplayFor(m => m.PANNumber)</td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">Vendor Name</td>
                                                    <td>
                                                        @Html.HiddenFor(m => m.VendorName)
                                                        @Html.HiddenFor(m => m.VendorName)
                                                        @Html.DisplayFor(m => m.VendorName)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Invoice Date</td>
                                                    <td>@*@Html.DisplayFor(m => m.InvoiceDate)*@
                                                        @Model.InvoiceDate.Value.ToString("dd/MM/yyyy")
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td style="font-weight:bold;">GSTIN</td>
                                                    <td>@Html.DisplayFor(m => m.GSTIN)</td>
                                                </tr>
                                                @*
                                                <tr>
                                                    <td style="font-weight:bold;">Place of Supply</td>
                                                    <td>@Html.DisplayFor(m => m.PlaceOfSupply)</td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Reverse Charges</td>
                                                    <td>
                                                        @if (Model.ReverseCharges)
                                                        {<text>Yes</text>}
                                                        else
                                                        {<text>No</text>}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Ecommerce GSTIN</td>
                                                    <td>@Html.DisplayFor(m => m.EcommerceGSTIN) </td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Taxable Value</td>
                                                    <td>@Html.DisplayFor(m => m.TaxableValue)</td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Tax Percent</td>
                                                    <td>@Html.DisplayFor(m => m.TaxPercent)</td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight:bold;">Cess Amount</td>
                                                    <td>@Html.DisplayFor(m => m.CessAmount)</td>
                                                </tr>
                                                *@
                                                @if (Model.UserTypes != null)
                                                {
                                                    for (int i = 0; i < Model.UserTypes.Count; i++)
                                                    {
                                                        <tr class="RowClass">
                                                            <td style="font-weight:bold;">@Html.DisplayFor(m => m.UserTypes[i].UserTypeName)</td>
                                                            <td>@Html.DisplayFor(m => m.UserTypes[i].UserName, new { @class = "form-control" })</td>
                                                        </tr>
                                                    }
                                                }
                                                @if(ViewBag.account == "Enabled")
                                                {
                                                    <tr>
                                                        <td style="font-weight:bold;">
                                                            @Html.DisplayNameFor(model => Model.VoucherType)
                                                            @Html.ValidationMessageFor(model => Model.VoucherType)
                                                        </td>
                                                        <td>
                                                            @Html.DropDownListFor(model => Model.VoucherType, new SelectList(ViewBag.VoucherList, "Value", "Text"),"Select Voucher", new { @class = "ddlUsers form-control" })
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- .panel-body -->
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-12" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                    <div class="panel-heading">
                                        <span class="widget-icon"> <i class="fa-lg fa fa-th-list"></i></span>
                                        <b>ITEM LIST</b>
                                    </div>
                                    <div class="panel-body items">
                                        <style>
                                            display tbody tr:nth-child(2n+1) {
                                                background-color: #f9f9f9;
                                            }

                                            .item-list input {
                                                width: 110px;
                                            }
                                            .panel-body.items{
                                                overflow-x:auto;
                                            }
                                        </style>
                                        <table class="item-list table table-bordered table-hover table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Category Name</th>
                                                    @if (ViewBag.account == "Enabled" && ViewBag.ERP != false)
                                                    {
                                                        <th>Ledger Name</th>
                                                    }
                                                    
                                                    <th>Name</th>
                                                    <th>UOM</th>
                                                    <th>HSN</th>
                                                    <th>Price</th>
                                                    <th>Qty</th>
                                                    <th>Amount</th>
                                                    <th>IGST</th>
                                                    <th>I.Amount</th>
                                                    <th>SGST</th>
                                                    <th>S.Amount</th>
                                                    <th>CGST</th>
                                                    <th>C.Amount</th>
                                                    <th>Total</th>
                                                   
                                                </tr>
                                            </thead>
                                            <tbody class="invoice-view">
                                                @if(Model.InvoiceItems != null)
                                                { 
                                                foreach(var items in Model.InvoiceItems)
                                                {
                                                    <tr>

                                                        <td>@Html.DisplayFor(m => items.CategoryId )</td>
                                                        @if(ViewBag.account == "Enabled" && ViewBag.ERP != false)
                                                        {

                                                            <td><input id=@("updateid"+Model.InvoiceItems.IndexOf(items)) type="hidden" value= @items.Id ><input class="ledger-list form-control" type="text" id=@("ledger"+Model.InvoiceItems.IndexOf(items)) name=@("ledger"+ Model.InvoiceItems.IndexOf(items)) /><span>LedgerName Can't be Empty</span></td>
                                                        }
                                                        <td>@Html.DisplayFor(m => items.Name)</td>
                                                        <td>@Html.DisplayFor(m => items.UOM)</td>
                                                        <td>@Html.DisplayFor(m => items.HSN)</td>
                                                        <td>@Html.DisplayFor(m => items.Price)</td>
                                                        <td>@Html.DisplayFor(m => items.Qty)</td>
                                                        <td>@Html.DisplayFor(m => items.Amount)</td>
                                                        <td>@Html.DisplayFor(m => items.IGST)</td>
                                                        <td>@Html.DisplayFor(m => items.IAmount)</td>
                                                        <td>@Html.DisplayFor(m => items.SGST)</td>
                                                        <td>@Html.DisplayFor(m => items.SAmount)</td>
                                                        <td>@Html.DisplayFor(m => items.CGST)</td>
                                                        <td>@Html.DisplayFor(m => items.CAmount)</td>
                                                        <td>@Html.DisplayFor(m => items.Total) </td>
                                                        <td>@Html.DisplayFor(m => items.Ledgerlist)</td>
                                                    </tr>
                                                }
                                             }
                                            </tbody>
                                            
                                            @if (Model.InvoiceItems.Count !=0) {
                                                <a name="grnview" href=@("grnview?id="+ Model.InvoiceItems[0].InvoiceId) target="_blank">View GRN</a>
                                            }
                                        </table>
                                    </div>
                                </div>
                            </div>
                            @if(ViewBag.account == "Enabled") {
                                <script>
                                    console.log("Ledger:");
                                    var erp = '@Html.Raw(ViewBag.ERP)'
                                    if(erp != 'False')
                                    {

                                    
                                        var ledgerdata = @Html.Raw(ViewBag.ledgerdata)
                                        console.log(ledgerdata);
                                        var ledgerdb = ledgerdata.Data.ledgerlist;
                                        //console.log(ledgerdata.Data.ledgerlist);
                                        var options = ledgerdb.map(function(x,idx){

                                            return {id:x,value:x};

                                        });
                                            $(".ledger-list").autocomplete({
                                            source: options,
                                            response: function (event, ui) {
                                                if (!ui.content.length) {
                                                    var noResult = { value: "", label: "No Items matching your request" };
                                                    ui.content.push(noResult);
                                                }
                                            },
                                            select: function (event, ui) {


                                            }
                                            ,
                                            minLength: 1
                                        });
                                    }
                                    $("#invoceupdateform").submit(function () {
                                        var submitdisable = true;
                                        if ($("#invoceupdateform").validate().form()) {
                                            console.log("Form true");
                                            submitdisable = true;
                                        }
                                        else {
                                            console.log("Form false");
                                            submitdisable = false;
                                        }

                                        var reject = $('#idReject').prop('checked');
                                        if(reject != true)
                                        {
                                            if(erp != 'False')
                                            {
                                                var led = [];
                                                $(".invoice-view tr").each(function(idx,ele){
                                                    var ledger = $("#ledger"+idx).val();
                                                    console.log("led"+ledger);
                                                    if(ledger == ""){
                                                        $("#ledger"+idx+" +span").addClass("ledger-error");
                                                        $("#ledger"+idx).addClass("ledger-error-input");
                                                        //return false;
                                                    }
                                                    else{
                                                        $("#ledger"+idx+" + span").removeClass("ledger-error");
                                                        $("#ledger"+idx).removeClass("ledger-error-input");
                                                    }
                                                    var updateid = $("#updateid"+idx).val();
                                                    var invoiceid = @Model.InvoiceID;
                                                    if(ledger != ""){
                                                        var ledgerobj = { InvoiceId:invoiceid,LedgerName:ledger, UpdateId:updateid};
                                                        led.push(ledgerobj);
                                                    }
                                                });
                                           

                                                if(led.length == $(".invoice-view tr").length){
                                                    //$("#cmdSubmit").prop("disabled",true);
                                                    $.post("UpdateLedger",{led},function(data,status){

                                                        if(status == "success")
                                                        {
                                                            console.log("disable"+submitdisable);
                                                            if (submitdisable)
                                                            {
                                                                $("#cmdSubmit").prop("disabled", true);
                                                            }
                                                            else {
                                                                return false;
                                                            }
                                                            return true;

                                                        }
                                                        else{
                                                            console.log(status);
                                                            return false
                                                        }

                                                    });
                                                }
                                                else{
                                                    return false;
                                                }
                                            }
                                        }
                                        else{
                                            return true;
                                        }
                                    });
                                    $(".invoice-view").on("input",".ledger-list",function(){

                                        var id = $(this).attr("id");

                                        if($("#"+id).val() != "")
                                        {
                                            $("#"+id).removeClass("ledger-error-input");
                                            $("#"+id + " +span").removeClass("ledger-error");
                                        }
                                        else{
                                            $("#"+id).addClass("ledger-error-input");
                                            $("#"+id + " +span").addClass("ledger-error");
                                        }
                                    });

                                </script>
                                <style>
                                    .ledger-list + span {
                                        color: red;
                                        display:none;
                                        font-size: 10px;
                                    }
                                    .ledger-error{
                                        display:block!important;
                                    }
                                    .ledger-error-input{
                                        border:1px solid #ff0000;
                                        background-color: #ffeeee;
                                       
                                    }
                                </style>
                            }
                            <div class="col-sm-12 col-md-12" style="background-color:white">
                                <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                    <div class="panel-heading">
                                        <span class="widget-icon"> <i class="fa-lg fa fa-table"></i> </span>
                                        <b> DEBIT NOTE </b>
                                    </div>
                                    <div class="panel-body">
                                        <div id="divDataCredit">
                                            <table id="divnotes" class="table-striped table-bordered table-hover table-condensed" style="width:100%;">
                                                <tr id="notesrow" class="item">
                                                    <td>
                                                        Generated Notes
                                                    </td>
                                                    <td>
                                                        <!--<table id="divnoteslist" class="table-striped table-bordered table-hover table-condensed" style="width:100%;">
                                                            <tr>
                                                                <td></td>
                                                            </tr>
                                                        </table>-->
                                                    </td>
                                                    @if (Model.CreditDebitNotes != null)
                                                    {
                                                        for (int i = 0; i < Model.CreditDebitNotes.Count; i++)
                                                        {
                                                            <td style="font-weight:bold;"><a class="noteslink" href="CreditView?Id=@Html.DisplayFor(m => m.CreditDebitNotes[i].CrDrNoteID)">@Html.DisplayFor(m => m.CreditDebitNotes[i].NoteType)&nbsp;Note</a></td>
                                                        }
                                                    }
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                        </div>

                                <div class="col-sm-12 col-md-12" style="background-color:white">
                                    <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                        <div class="panel-heading">
                                            <span class="widget-icon"> <i class="fa-lg fa fa-pencil-square-o"></i></span>
                                            <b>APPROVAL HISTORY</b>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-inline" role="form">
                                                <div align="center" id="cmnt" style="border: thin inset;">

                                                    <table id="divcomments" class="table-striped table-bordered table-hover table-condensed" style="width:100% ">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                            </tr>

                                                        </thead>

                                                    </table>
                                                </div>

                                                <div id="labelfinaladetails" style="display:none;border: thin inset ">

                                                    <fieldset>
                                                        <div class="row">
                                                            <section>
                                                                <table style="border-collapse:separate; border-spacing:16px; width:88%" align="left" class="table-bordered table-hover ">
                                                                    <tr>
                                                                        <td align="right">
                                                                            <section class="col col-4">
                                                                                <label class="input">
                                                                                    Navision Voucher No :
                                                                                </label>

                                                                            </section>
                                                                        </td>
                                                                        <td align="left">
                                                                            <section class="col col-4">
                                                                                <label class="input" id="lblNavisionVoucherno">
                                                                                    @*@Html.TextBoxFor(m => m.Navisionvoucherno, new { placeholder = "Navision Voucher ", @class = "final", id = "txtNavisionVoucherno" })*@
                                                                                    @Html.ValidationMessageFor(m => m.InvoiceAmount)
                                                                                </label>

                                                                            </section>
                                                                        </td>

                                                                    </tr>
                                                                </table>
                                                            </section>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>


                                @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 2 || int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3)*@
                                @if (true)
                                {
                                    <div class="col-sm-12 col-md-12" style="background-color:white">
                                        <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                            <div class="panel-heading">
                                                <span class="widget-icon"> <i class=" fa-lg fa fa-table"></i> </span>
                                                <b>VENDOR RATING</b>
                                            </div>
                                            <div class="panel-body">
                                                <div class="form-inline" role="form">
                                                    <div class="widget-body">
                                                        <div class="input-group" style="width:100%">
                                                            <div id="divRating" class="col-sm-12" style="width:100%">
                                                                <table style="border-collapse:separate; border-spacing:16px; width:80%" align="left" class="table-bordered table-condensed table-hover">
                                                                    <tr>
                                                                        @if (ViewBag.VendorRating == "Edit")
                                                                        {
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 1, new { id = "radioRating1", @data_val = false })
                                                                                    <i></i>1 (Excellent)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 2, new { id = "radioRating2", @data_val = false })
                                                                                    <i></i>2 (Very Good)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 3, new { id = "radioRating3" , @data_val = false })
                                                                                    <i></i>3 (Good)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 4, new { id = "radioRating4", @data_val = false })
                                                                                    <i></i>4 (Average)
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.RadioButtonFor(x => x.Rating, 5, new { id = "radioRating5", @data_val = false })
                                                                                    <i></i>5 (Below Average)
                                                                                </label>
                                                                            </td>
                                                                        }
                                                                        else
                                                                        {
                                                                            foreach(var item in Model.VendorRatings)
                                                                            { 
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%">
                                                                                    @Html.DisplayFor(m => item.URatings)
                                                                                   

                                                                                </label>

                                                                            </td>
                                                                            <td>
                                                                                @*@Html.DisplayFor(m => item.Ratings)*@
                                                                                @if (item.Ratings == 1)
                                                                                {
                                                                                    <Text>Excellent</Text>
                                                                                }
                                                                                else if (item.Ratings == 2)
                                                                                {
                                                                                    <Text>Very Good</Text>
                                                                                }
                                                                                else if (item.Ratings == 3)
                                                                                {

                                                                                    <Text>Good</Text>
                                                                                }
                                                                                else if (item.Ratings == 4)
                                                                                {
                                                                                    <Text>Average</Text>
                                                                                }
                                                                                else if (item.Ratings == 5)
                                                                                {
                                                                                    <Text>Below Average</Text>
                                                                                }
                                                                            </td>
                                                                           
                                                                            <td>@Html.HiddenFor(x => x.Rating)</td>
                                                                            }
                                                                        }
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                            <br />
                                                            @if (ViewBag.VendorRating == "Edit")
                                                            {
                                                                <div id="divComment" align="left" class="col-sm-12" style="width:100%">
                                                                    @Html.TextAreaFor(m => m.VendorComment, new { placeholder = "Your comment here...", id = "txtComment", @rows = 4, @class = "form-control", @style = "width:80%" })
                                                                    @Html.ValidationMessageFor(m => m.VendorComment)
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }

                                @*=========================================================================================*@
                                <div class="col-sm-12 col-md-12">
                                    <div class="panel panel-info" style="margin-left:10px;margin-right:10px;">
                                        <div class="panel-heading">
                                            <span class="widget-icon"> <i class="fa-lg fa fa-table"></i> </span>
                                            <b>ACTION ON INVOICE</b>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-inline" role="form">
                                                <div class="widget-body">
                                                    <div class="input-group" style="width:100%">
                                                        <div align="left" class="col-sm-12" style="width:100%" id="curentcoment">
                                                            @Html.TextAreaFor(m => m.Comment, new { placeholder = "Comment", id = "txtcomment", @cols = 20, @rows = 4, @class = "form-control", @style = "width:80%" })
                                                            @Html.ValidationMessageFor(m => m.Comment)
                                                        </div>
                                                    </div>
                                                    <div id="invoicepermissions" style="border: thin inset ; margin-top:1%">
                                                        <fieldset>
                                                            <div>
                                                                <section>
                                                                    <table style="border-collapse:separate; border-spacing:16px; width:80%" align="left" class="table-bordered table-condensed table-hover">
                                                                        <tr>


                                                                            @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 1 && Model.WFStatus == 300 )
                                                        {*@
                                                                            @*<td id="rdrecommend">
                                                            <label class="checkbox" style="margin-left:10%" id="chkAdmin">

                                                                @Html.RadioButtonFor(x => x.status, "A", new { @class = "reassign", id = "Recommend" })

                                                                <i></i>Recommend For payment
                                                            </label>
                                                        </td>*@
                                                                            @*}
                                                        else
                                                        {*@
                                                                            <td id="rdapprove">
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">

                                                                                    @Html.RadioButtonFor(x => x.status, "A", new { @class = "reassign", id = "radioApprove" })
                                                                                    @Html.ValidationMessageFor(m => m.status)
                                                                                    <i></i>Approve

                                                                                </label>

                                                                            </td>
                                                                            @*}*@
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                                                    @Html.RadioButtonFor(x => x.status, "R", new { @class = "reassign", id = "idReject" })
                                                                                    <i></i>Reject
                                                                                </label>
                                                                            </td>
                                                                            <td>
                                                                                <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                                                    @Html.RadioButtonFor(x => x.status, "H", new { @class = "reassign", id = "idHold" })
                                                                                    <i></i>Hold
                                                                                </label>
                                                                            </td>

                                                                            @*@if ((int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 2) || (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3))
                                                        {*@
                                                                            <!--
                                                    <td id="reassignradio">
                                                        <label class="checkbox" style="margin-left:10%" id="chkAdmin">
                                                            @Html.RadioButtonFor(x => x.status, "ReAssign", new { @class = "reassign", id = "reassign" })
                                                            <i></i>ReAssign
                                                        </label>
                                                    </td>  -->
                                                                            @*}*@

                                                                            @* Added If condition as per new change request *@
                                                                            @*@if (int.Parse(HttpContext.Current.Session["UserTypeID"].ToString()) == 3)
                                                        {*@
                                                                            <td style="display:none" id="reassigntd">
                                                                                <label class="select">
                                                                                    @Html.DropDownList("ReAssignID", new SelectList(ViewBag.ReAssignUsers, "Value", "Text"), " ReAssign", new { id = "drpdwnreassign" })
                                                                                    @Html.ValidationMessage("ReAssignID")
                                                                                </label>
                                                                            </td>


                                                                            @*@for (int i = 0; i < Model.UserTypes.Count; i++)
                                                        {
                                                             <td id="VoucherTypes">
                                                            @Html.DropDownListFor(model => Model.UserTypes[i].SelectedUserId, new SelectList(Model.UserTypes[i].Users, "Value", "Text"))

                                                             </td>
                                                        }*@
                                                                        </tr>


                                                                    </table>
                                                                </section>
                                                            </div>
                                                        </fieldset>
                                                    </div>
                                                    <br />
                                                    <br />
                                                    @Html.Hidden("hdnId")

                                                    <div id="finaladetails" style="display:none;border: thin inset ">

                                                        <fieldset>
                                                            <div class="row">
                                                                <section>
                                                                    <table style="border-collapse:separate; border-spacing:16px; width:100%" align="center" class="table-bordered table-hover ">
                                                                        <tr>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Navision Voucher No :
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">

                                                                                        @Html.TextBoxFor(m => m.Navisionvoucherno, new { placeholder = "Navision Voucher ", @class = "final", id = "txtNavisionVoucherno" })
                                                                                        @Html.ValidationMessageFor(m => m.InvoiceAmount)
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Date of Payment :
                                                                                    </label>

                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        @Html.TextBoxFor(m => m.DateOfPayment, new { placeholder = "Date of Payment", @class = "date final", id = "txtdateofpayment" })
                                                                                        @Html.ValidationMessageFor(m => m.DateOfPayment)
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        Date of Account :
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                            <td>
                                                                                <section class="col col-4">
                                                                                    <label class="input">
                                                                                        @Html.TextBoxFor(m => m.DateOfAccount, new { placeholder = "Date Of Account", @class = "date final", id = "txtDateOfAccount" })
                                                                                        @Html.ValidationMessageFor(m => m.DateOfAccount)
                                                                                    </label>
                                                                                </section>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </section>
                                                            </div>
                                                        </fieldset>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @*=========================================================================================*@


                            </div><div class="col-md-10 col-md-offset-2">
                            <button class="btn btn-primary cmd " type="submit" id='cmdSubmit'>
                                <i class="fa fa-save"></i>
                                Submit
                            </button>
                            <button class="btn btn-primary cmd" type="button" id='btnReassign' style="margin-left:8px; display:none">
                                Re-Assign
                            </button>
                            <button class="btn btn-default cmd" type="button" id='cancelbtn' style="margin-left:8px">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-6 -->
            </div>

        }

        <!--<button type="button" id="somebutton">SomeButton</button>-->
    </div>

}
<script>
    $("#notesrow").on("click", ".noteslink", function (e) {
        e.preventDefault();
        $("#mframe").attr("src", $(this).attr("href"));
        $("#myModal").modal();

    })

</script>
<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content" style="width:800px;position:  relative;right: 40px;">
          
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <!--<h4 class="modal-title">Modal Header</h4>-->
            </div>
            <div class="modal-body" style="height:500px;">
                <iframe id="mframe" style="height:100%;width:100%;border:none" src="#"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>


<!-- /#page-wrapper -->


@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>

 Bootstrap Core JavaScript 
<script src="~/Scripts/bootstrap.min.js"></script>*@
<!-- Metis Menu Plugin JavaScript -->
@*<script src="~/bower_components/metisMenu/dist/metisMenu.min.js"></script>*@
<script src="~/bower_components/metisMenu/dist/metisMenu.min.js"></script>
<!-- Custom Theme JavaScript -->
@*<script src="~/dist/css/js/sb-admin-2.js"></script>*@
<script src="~/dist/css/js/sb-admin-2.js"></script>

<script src="http://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/js/bootstrap-multiselect.js"> </script>
<!-- Page-Level Demo Scripts - Notifications - Use for reference -->
<script>
    // tooltip demo
    $('.tooltip-demo').tooltip({
        selector: "[data-toggle=tooltip]",
        container: "body"
    })
    // popover demo
    $("[data-toggle=popover]")
        .popover()
</script>

<script>
    $(document).ready(function() {

      
       

       

        $('.date').datepicker({
            //changeMonth: true,
            //changeYear: true,
            dateFormat: "dd/mm/yy",
            autoclose: true,
           // yearRange: "2000:+1000"
        });

        


        $('.timepicker').timepicker({
            timeFormat: 'h:mm p',
            interval: 5,
            minTime: '9',
            maxTime: '9:00pm',
            //defaultTime: '11',
            startTime: '9:00',
            dynamic: false,
            dropdown: true,
            scrollbar: true
        });
       
        $.validator.methods.date = function (value, element) {
            console.log("date:"+value);
            //console.log($.datepicker.parseDate('dd/mm/yy', value));
            return this.optional(element) ||  value;
        }

        var filepath = '@Url.Action("GetFile", "Invoice", new { @filepath = Model.filePath })'
        

        var ext = filepath.substring(filepath.lastIndexOf(".") + 1);
        

        //var filerel = $("#icon-navbar tr:nth-child(" + clickedchild + ") img").attr('rel');
        if (ext == "jpg") {            
            $("#object_id").addClass("hide-display");
            $("#imgviewer").removeClass("hide-display");
            $(".zoom-icon").removeClass("hide-display"); 
            console.log("image--");
            $("#view").attr("src", filepath);
        }
        else {            
            $("#imgviewer").addClass("hide-display");
            $(".zoom-icon").addClass("hide-display");
            $("#object_id").removeClass("hide-display");
          //  $("#object_id").attr("data", "getfile?filepath=" + encodeURIComponent(filpath));
        }
    });
    $("#plus").click(function(){
        console.log("plus");
      
        var height = parseInt($("#imgviewer > #view").attr("height"));
        var width = parseInt($("#imgviewer > #view").attr("width"));

        height = height + 20;
        width = width + 20;
        $("#imgviewer > #view").attr("height",height);
        $("#imgviewer > #view").attr("width",height);
    });
    $("#minus").click(function(){
        console.log("minus");
        var height = parseInt($("#imgviewer > #view").attr("height"));
        var width = parseInt($("#imgviewer > #view").attr("width"));
        height = height - 20;
        width = width - 20;
        $("#imgviewer > #view").attr("height",height);
        $("#imgviewer > #view").attr("width",height);
    });
</script>
<style type="text/css">
    #divInvoiceImages {
        height: 600px;
        /*width: 400px;*/
    }

    #divInvoiceDetails {
        position: relative;
        left: 64%;
        top: 1%;
        width: 36%;
        max-height: 98%;
        min-height: 98%;
        border: thin solid black;
    }

    #divInvoiceImage {
    }

    /*#imgInvoiceImage {
                                -ms-zoom: 0.75;
                                -moz-transform: scale(0.75);
                                -moz-transform-origin: 0 0;
                                -o-transform: scale(0.75);
                                -o-transform-origin: 0 0;
                                -webkit-transform: scale(0.75);
                                -webkit-transform-origin: 0 0;
                                overflow: scroll;
                            }*/

    #imgInvoiceImages {
        width: 100%;
        height: 100%;
    }





    /*Image Controls*/
    .imglist {
        display: none;
    }

    .cmdpv {
        cursor: pointer;
    }

    /* Styles for validation helpers
                            -----------------------------------------------------------*/
    .field-validation-error {
        color: #ff0000;
    }

    .field-validation-valid {
        display: none;
    }

    .input-validation-error {
        border: 1px solid #ff0000;
        background-color: #ffeeee;
    }

    .validation-summary-errors {
        font-weight: bold;
        color: #ff0000;
    }

    .validation-summary-valid {
        display: none;
    }

    .ui-jqgrid tr.jqgrow td.wrap {
        white-space: normal !important;
        height: auto;
        padding-top: 2px;
        word-wrap: break-word;
    }

    .ui-jqgrid tr.jqgrow td {
        white-space: normal !important;
        height: auto;
        vertical-align: text-top;
        padding-top: 2px;
        word-wrap: break-word;
    }

    .ui-jqgrid .ui-jqgrid-htable th div {
        height: auto;
        overflow: hidden;
        padding-right: 4px;
        padding-top: 2px;
        position: relative;
        vertical-align: text-top;
        white-space: normal !important;
    }

    #tbInvoiceImages {
    }

        #tbInvoiceImages td {
            border: 1px solid;
            padding: 3px 5px 3px 5px;
            text-align: center;
        }

    /*#tbInvList {
                                    width: 98%;
                                    top: 2%;
                                    left: 1%;
                                    height: auto;
                                    position: absolute;
                                    border: 1px solid lime;
                                }

                                    #tbInvList td, #tbInvList th {
                                        border: thin solid black;
                                        padding: 5px 3px 5px 3px;
                                    }*/

    .notapproved {
        color: blue;
    }

    .approved {
    }

    .ec-caret {
    }

    .ec-tr {
        display: none;
    }

    .ec-div {
        position: relative;
        width: 100%;
        overflow: auto;
        padding: 0;
        height: 92%;
        border: thin inset;
        margin-bottom: 1.5%;
    }

    .ec-table-invoice-image-icons {
        left: .2%;
        width: 8%;
        height: auto;
        border: thin solid white;
    }

    .ec-div-invoice-image {
        left: 9%;
        top: 1%;
        width: 49%;
        height: 86%;
        border: thin solid black;
        position: absolute;
        margin-top: 2px;
    }

    .ec-table-invoice-image-commands {
        left: 9%;
        top: 88%;
        width: 49%;
        position: absolute;
    }

    .ec-table-invoice-editor {
        left: 60%;
        width: 40%;
        top: 0%;
        border: thin solid;
        position: absolute;
        margin-top: 0px;
    }

    .ec-table-invoice-image-commands td {
        padding: 2px !important;
        border: thin solid;
        text-align: center;
        vertical-align: middle;
    }

    .tablepad td {
        border: none !important;
        padding: 5px 2px 5px 2px;
    }


    .ec-invoice-image-icon {
        position: relative;
        width: 60px;
        height: 60px;
    }

    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    html {
        -ms-touch-action: none;
    }
</style>

<script>
    //$("tr.item").each(function() {
    //    $('td', this).each(function () {
    //        //var value = $(this).find("a").text();
    //        $(this).find('a.noteslink').remove();
    //    })
    //})
        //your code   

        var array = @Html.Raw(Json.Encode(ViewBag.SelectedLedgers));
             $('#ledgerlist').val(array);
  
    window.links = [];
    $('#SupportFile').on('change', function (e) {
       var file = e.target.files;
        //var myID = 3; //uncomment this to make sure the ajax URL works

    });
    // ////////////////////////////////////////////////////////////////////////////

    var files = "";
    $('#txtUploadFile').on('change', function (e) {
        files = e.target.files;
        //var myID = 3; //uncomment this to make sure the ajax URL works

    });

    $('#cancelbtn').click(function (e) {
        var url = '@Url.Action("Index", "Dashboard")';
        window.location.href = url;
    });
    $('#btnAdd').click(function (e) {
        if (files.length > 0) {

            if (window.FormData !== undefined) {
                var data = new FormData();
                for (var x = 0; x < files.length; x++) {
                    if (files[x].type == "application/pdf") {
                        data.append("file" + x, files[x]);
                    }
                    else {
                        alert("Please Upload Pdf File only");
                        return false;
                    }
                }
                var stramt = $("#DebitAmount").val();
                var amount = $("#DebitAmount").val();
                var invId = $("#InvoiceID").val();

                rowKey = invId;
                 $('#hdnId').val(rowKey);
                $.ajax({
                    type: "post",
                    // async: false,
                    /// url: '/Invoice/UpdateDebitData/',
                    url: '/Invoice/UpdateDebitData?id=' + invId + '&amount=' + amount,
                    contentType: false,
                    processData: false,
                    data: data,
                    // data: { "id": invId, "amount": amount },
                    success: function (jsondata) {
                        alert("Success");
                        var x = $("#lblInvoiceAmount").text();
                        var y = (x - amount);
                        $("#lblInvoiceAmount").text(y);

                        //////////////////////////////////////////////////////
                        $("#divcreditdetails").empty();
                        $.ajax({
                            type: "post", async: false,
                            url: '/Invoice/getCreditDetails/',
                            data: { invoiceno: rowKey },
                            success: function (jsondata) {
                                if (jsondata.success < 1) {
                                    return;
                                }
                                var totamount = 0;
                                $("#DebitAmount").val("");
                                $("#txtUploadFile").val("");

                                $.each(jsondata.creditlist, function (k, v) {
                                    //$("#divcreditdetails").append("<tr><td><label id='UserID" + v.CreditNoteId + "' class='edit-mode'>" + v.CreditNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.CreditNoteId + "'>" + v.CreditFileName + "</a></span></td><td id=labeltd" + v.CreditNoteId + ">" + v.CreditAmount + " </td><td style='display:none' id='editTd" + v.CreditNoteId + "'><input type='text' style='display:none' value='" + v.CreditAmount + "' id='inputamount" + v.CreditNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.CreditNoteId + "' onclick='editDetails(" + v.CreditNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.CreditNoteId + "' style='display:none' onclick='UpdateDetails(" + v.CreditNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.CreditNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                                    $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");

                                    totamount = totamount + v.CreditAmount
                                });
                                var amttot = $("#txtInvoiceAmount").val();
                                var amtlbt = $("#hdnInvoiceAmount").val();

                                amtlbt = Number(amtlbt) - Number(stramt);
                                $("#txtInvoiceAmount").html(amtlbt);
                                $("#hdnInvoiceAmount").val(amtlbt);
                                //if((totamount-amttot)>0)
                                //{
                                //    $("#btnAdd").hide();
                                //    $("#lblamountexd").show();
                                //}
                            },
                            error: function (xhr, st, et) { alert(xhr.responseText); }
                        });
                        e.preventDefault();

                        //////////////////////////////////////////////////////////
                    }
                })
            }
        }
    });
    ///////////////////////////////////////////////////////////////////////////////////
    $("input[name='status']").click(function () {

        if ($('input:radio[name=status]:checked').val() == "ReAssign") {
            //  alert($('input:radio[name=status]:checked').val());
            $("#reassigntd").show();
        }
        else {
            $("#reassigntd").hide();
        }
    });


    function UpdateDetails(id) {
        var stramt = 0 
        var invId = $("#InvoiceID").val();
        stramt = $("#inputamount" + id + "").val()
        if (stramt == "") {
            stramt = "null";
        }
        if (stramt == "null" || stramt == "0") {
            alert('Enter Correct Amount');
            return false;
        }
        else {
            var invamt = $("#hdnInvoiceAmount").val();
            if (Number(invamt) < 0) {
                $("#btnAdd").hide();
                if (isNaN(stramt)) {
                    alert("Enter Number");
                    return false;
                }
                else {
                    if (Number(stramt) + Number(invamt) == 0) {
                        $.ajax({
                            type: "post",
                            async: false,
                            url: '/Invoice/UpdateCredit/',
                            data: { "creditId": id, "amount": stramt },
                            success: function (jsondata) {
                                alert("Success");
                                var rowKey = $('#InvoiceID').val();

                                $("#divcreditdetails").empty();
                                $.ajax({
                                    type: "post", async: false,
                                    url: '/Invoice/getCreditDetails/',
                                    data: { invoiceno: rowKey },
                                    success: function (jsondata) {
                                        if (jsondata.success < 1) {
                                            return;
                                        }
                                        var totamount = 0;
                                        $.each(jsondata.creditlist, function (k, v) {
                                            $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.CreditNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                                            totamount = totamount + v.CreditAmount
                                        });
                                        var amttot = $("#hdnInvoiceAmount").val();
                                        amttot = Number(amttot) + Number(prvamt);
                                        amttot = Number(amttot) - Number(stramt);
                                        $("#txtInvoiceAmount").html(amttot);
                                        $("#hdnInvoiceAmount").val(amttot);

                                    },
                                    error: function (xhr, st, et) { alert(xhr.responseText); }
                                });
                            },
                            error: function (xhr, st, et) { alert(xhr.responseText); }
                        });
                    }
                    {
                        alert("Invoice Amount Exceed,Update Amount To" + invamt);
                    }
                    return false;
                }
            }
            else {
                $("#btnAdd").show();
                if (isNaN(stramt)) {
                    alert("Enter Number");
                    return false;
                }
                else {
                    $.ajax({
                        type: "post",
                        async: false,
                        url: '/Invoice/UpdateCredit/',
                        data: { "creditId": id, "amount": stramt },
                        success: function (jsondata) {
                            alert("Success");
                            var rowKey = $('#InvoiceID').val();

                            $("#divcreditdetails").empty();
                            $.ajax({
                                type: "post", async: false,
                                url: '/Invoice/getCreditDetails/',
                                data: { invoiceno: rowKey },
                                success: function (jsondata) {
                                    if (jsondata.success < 1) {
                                        return;
                                    }
                                    var totamount = 0;
                                    $.each(jsondata.creditlist, function (k, v) {
                                        $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                                        totamount = totamount + v.DebitAmount
                                    });
                                    var amttot = $("#hdnInvoiceAmount").val();
                                    amttot = Number(amttot) + Number(prvamt);
                                    amttot = Number(amttot) - Number(stramt);
                                    $("#lblInvoiceAmount").html(amttot);
                                    $("#hdnInvoiceAmount").val(amttot);

                                },
                                error: function (xhr, st, et) { alert(xhr.responseText); }
                            });
                        },
                        error: function (xhr, st, et) { alert(xhr.responseText); }
                    });
                }
            }
        }

    }
    $("#InvoiceAmount").change(function() {
        calculate();
    });
    $("#TaxPercent").change(function() {
        calculate();
    });
    function calculate(){
        var amount = parseInt($("#InvoiceAmount").val());
        var tax = parseInt($("#TaxPercent").val());
        var taxable = (amount * tax )/100;
        //console.log("taxable"+taxable);
        $("#TaxableValue").val(taxable);
    }

    function DeleteCredit(id) {
        var prvamt = $("#labeltd" + id + "").text();
        $.ajax({
            type: "post",
            async: false,
            url: '/Invoice/DeleteCredit',
            data: { "debitId": id },
            success: function (jsondata) {
                alert("Success");
                var rowKey = $('#InvoiceID').val();
               // console.log(rowKey);
                $("#divcreditdetails").empty();
                $.ajax({
                    type: "post", async: false,
                    url: '/Invoice/getCreditDetails',
                    data: { invoiceno: rowKey },
                    success: function (jsondata) {
                        if (jsondata.success < 1) {
                            return;
                        }
                        var totamount = 0;
                        $.each(jsondata.creditlist, function (k, v) {
                            $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                            totamount = totamount + v.DebitAmount
                        });

                        var amttot = $("#hdnInvoiceAmount").val();

                        var amtlbt = Number(amttot) + Number(prvamt);
                        $("#txtInvoiceAmount").html(amtlbt);
                        $("#hdnInvoiceAmount").val(amtlbt);


                    },
                    error: function (xhr, st, et) { alert(xhr.responseText); }
                });
            },
            error: function (xhr, st, et) { alert(xhr.responseText); }
        });
    }

    function generateCrDrNote()
    {
        var formData = $("#invoceupdateform").serialize();
        $.ajax({
            type: "post",
            async: false,
            url: '/Invoice/GenerateCrDrNote/',
            data: formData,
            success: 
            //    function (data) {
            //    if (data.result == "Error") {
            //        alert(data.message);
            //    }
            //}
            function (jsondata) {
                if (jsondata.success < 1) {
                    return;
                }

                $('#divnotes tr').each(function() {
                    $(this).find('td').each (function() {
                        // do your cool stuff
                        
                        var tdtext = $(this).text();
                        if((tdtext == "Credit Note") || (tdtext == "Debit Note"))
                        {
                            alert("test");
                            $(this).remove();
                        }
                    });

                });

                var ptr = $("#divnotes").find("tr");
                var tdval = ptr.find("td:last").text();
                
                if((tdval == "Credit Note") || (tdval == "Debit Note"))
                {
                    alert(tdval);
                    ptr.remove("td:last");
                }
                //ptr.find("td:last").remove();
                var removed = 0;
                var parsed = $.parseJSON(jsondata.noteslist);
                $.each(parsed, function (k, v) {

                    if(removed === 0) {
                        $("tr.item").each(function() {
                            $('td', this).each(function () {
                                //var value = $(this).find("a").text();
                                $(this).find('a.noteslink').remove();
                            })
                        })
                        removed = 1;
                    }
                    $("#notesrow").append(
                      //"<tr><td>" + v.Comment + " </td> </tr>"
                      "<td style='font-weight:bold;'><a class='noteslink' href='CreditView?Id=" + v.CrDrNoteId + "'>" + v.NoteType + "&nbsp;Note</a></td>"
                   );
                });

            },
            error: function (xhr, st, et) { alert(xhr.responseText); }
        });
    }

    function updateCreditamount(id) {
        var creditid = $("#creditnoteid").val();
        var creditamt = $('#txtamount').val();
        if (creditamt == "") {
            creditamt = "null";
        }
        if (creditamt == "null" || creditamt == "0") {
            alert('Enter Correct Amount');
            return false;
        }
        else {
            if (isNaN(creditamt)) {
                alert("Enter Number");
                return false;
            }
            else {
                $.ajax({
                    type: "post",
                    async: false,
                    url: '/Invoice/UpdateCreditData/',
                    data: { "creditId": creditid, "creditamount": creditamt },
                    success: function (jsondata) {


                        window.location.href = '/Invoice/Invoiceview/';

                    },
                    error: function (xhr, st, et) { alert(xhr.responseText); }
                });
            }
        }
    }

    var rowKey = "82";
    //comment
    $.ajax({
        type: "post",
        async: false,
        url: '/Invoice/getcomments/',
        data: { invoiceno: rowKey },
        success: function (jsondata) {
            if (jsondata.success < 1) {
                return;
            }
            var parsed = $.parseJSON(jsondata.commentlist);
            $.each(parsed, function (k, v) {
                $("#divcomments").append(
                  "<tr><td>" + v.Comment + " </td> </tr>"
               );
            });

        },
        error: function (xhr, st, et) { alert(xhr.responseText); }
    });


    var frmInvoiceImageList = new window.FormData();
    var mNumberOfImages = -1;
    var currentDisplayedImageTD = null;
    var deletedInvoiceImageList = [];

    function ec_showInvoiceImage1() {
        $("#iframeInvoiceImage").removeAttr('src');
    }

    function nextimage(prev_next) {

        if ($("#tbimglist tr:nth-child(1) td").length < 1) return;
        if (prev_next == 1) {
            currentDisplayedImageTD = $(currentDisplayedImageTD).next("td");
            if (currentDisplayedImageTD.length < 1) currentDisplayedImageTD = $("#tbimglist tr:nth-child(1) td:first");

            var rsrc = $("img", currentDisplayedImageTD)[0].src;
            var rext = rsrc.substring(rsrc.lastIndexOf(".") + 1);
            if (rext != "pdf") {

                $("#imgInvoiceImage")[0].src = $("img", currentDisplayedImageTD)[0].src;
                $("#iframeInvoiceImage").hide();
                $("#imgInvoiceImage").show();
                // wheelzoom(document.getElementById('imgInvoiceImage'));
                $(".zoombtn").show();
            }
            else {

                $("#iframeInvoiceImage").attr('src', rsrc);
                //  $("#iframeInvoiceImage").src = rsrc;
                $("#imgInvoiceImage").hide();
                $("#iframeInvoiceImage").show();
                $(".zoombtn").hide();
            }
        }
        if (prev_next == -1) {

            currentDisplayedImageTD = $(currentDisplayedImageTD).prev("td");
            if (currentDisplayedImageTD.length < 1) currentDisplayedImageTD = $("#tbimglist tr:nth-child(1) td:last");

            var rsrc = $("img", currentDisplayedImageTD)[0].src;
            var rext = rsrc.substring(rsrc.lastIndexOf(".") + 1);
            if (rext != "pdf") {

                $("#imgInvoiceImage")[0].src = $("img", currentDisplayedImageTD)[0].src;
                $("#iframeInvoiceImage").hide();
                $("#imgInvoiceImage").show();
                // wheelzoom(document.getElementById('imgInvoiceImage'));
                $(".zoombtn").show();
            }
            else {
                $("#iframeInvoiceImage").attr('src', rsrc);
                $("#imgInvoiceImage").hide();
                $("#iframeInvoiceImage").show();
                $(".zoombtn").hide();
            }
        }

        var n = $("#tbimglist td").length;
        $("#spannof").text(($(currentDisplayedImageTD)[0].cellIndex + 1) + "/" + n);
    }
    function removeimage() {


        if ($("#tbimglist td").length != 0) {
            if (currentDisplayedImageTD == null) return;

            var imgsrc = $("img", currentDisplayedImageTD)[0].src;
            var imgpath = imgsrc.substring(imgsrc.lastIndexOf("/") + 1);
            $.ajax({
                type: "post", async: false,
                url: '/Invoice/removeInvoiceImages',
                data: { filename: imgpath },
                success: function (jsondata) {

                    var imgid = $("img", currentDisplayedImageTD)[0].id;
                    $("#imgInvoiceImage")[0].src = '';

                    var tcurrentDisplayedImageTD = ($(currentDisplayedImageTD).next("td").length != 0 ? $(currentDisplayedImageTD).next("td") : $(currentDisplayedImageTD).prev("td"));
                    $(currentDisplayedImageTD).remove();



                    currentDisplayedImageTD = tcurrentDisplayedImageTD;
                    deletedInvoiceImageList.push("filetoupload" + imgid.split("_")[1]);

                    if ($("#tbimglist td").length != 0) {

                        $("#spannof").show();

                        var rsrc = $("img", currentDisplayedImageTD)[0].src;
                        var rext = rsrc.substring(rsrc.lastIndexOf(".") + 1);
                        if (rext != "pdf") {

                            $("#imgInvoiceImage")[0].src = $("img", currentDisplayedImageTD)[0].src;
                            $("#iframeInvoiceImage").hide();
                            $("#imgInvoiceImage").show();
                            // wheelzoom(document.getElementById('imgInvoiceImage'));
                            $(".zoombtn").show();
                        }
                        else {
                            $("#iframeInvoiceImage")[0].src = $("img", currentDisplayedImageTD)[0].src;
                            $("#iframeInvoiceImage").show();
                            $("#imgInvoiceImage").hide();
                            $(".zoombtn").hide();
                        }
                        //$("#imgInvoiceImage")[0].src = $("img", currentDisplayedImageTD)[0].src;
                        //wheelzoom(document.getElementById('imgInvoiceImage'));
                        var n = $("#tbimglist td").length;
                        $("#spannof").text(($(currentDisplayedImageTD)[0].cellIndex + 1) + "/" + n);
                    }
                    else {
                        $("#spannof").hide();
                    }



                },
                error: function (xhr, st, et) { alert(xhr.responseText); }

            });
        }
        else {

            alert("No Images are there to remove");
        }
        ClearText();
    }
    var prvamt = "";
    function editDetails(id) {
        prvamt = $("#labeltd" + id + "").text();

        $("#labeltd" + id + "").hide();
        $("#inputamount" + id + "").show();
        $("#editTd" + id + "").show();
        $("#addcontractbtn" + id + "").hide();

        $("#updatecontractbtn" + id + "").show();
    }
    
    function UpdateDetails(id) {
        var stramt = 0;
        stramt = $("#inputamount" + id + "").val()
        if (stramt == "") {
            stramt = "null";
        }
        if (stramt == "null" || stramt == "0") {
            alert('Enter Correct Amount');
            return false;
        }
        else {
            var invamt = $("#hdnInvoiceAmount").val();
            if (Number(invamt) < 0) {
                $("#btnAdd").hide();
                if (isNaN(stramt)) {
                    alert("Enter Number");
                    return false;
                }
                else {
                    if (Number(stramt) + Number(invamt) == 0) {
                        $.ajax({
                            type: "post",
                            async: false,
                            url: '/Invoice/UpdateCredit/',
                            data: { "creditId": id, "amount": stramt },
                            success: function (jsondata) {
                                alert("Success");
                                var rowKey = $('#InvoiceID').val();

                                $("#divcreditdetails").empty();
                                $.ajax({
                                    type: "post", async: false,
                                    url: '/Invoice/getCreditDetails/',
                                    data: { invoiceno: rowKey },
                                    success: function (jsondata) {
                                        if (jsondata.success < 1) {
                                            return;
                                        }
                                        var totamount = 0;
                                        $.each(jsondata.creditlist, function (k, v) {
                                            $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                                            totamount = totamount + v.DebitAmount
                                        });
                                        var amttot = $("#hdnInvoiceAmount").val();
                                        amttot = Number(amttot) + Number(prvamt);
                                        amttot = Number(amttot) - Number(stramt);
                                        $("#txtInvoiceAmount").html(amttot);
                                        $("#hdnInvoiceAmount").val(amttot);

                                    },
                                    error: function (xhr, st, et) { alert(xhr.responseText); }
                                });
                            },
                            error: function (xhr, st, et) { alert(xhr.responseText); }
                        });
                    }
                    {
                        alert("Invoice Amount Exceed,Update Amount To" + invamt);
                    }
                    return false;
                }
            }
            else {
                $("#btnAdd").show();
                if (isNaN(stramt)) {
                    alert("Enter Number");
                    return false;
                }
                else {
                    $.ajax({
                        type: "post",
                        async: false,
                        url: '/Invoice/UpdateCredit/',
                        data: { "creditId": id, "amount": stramt },
                        success: function (jsondata) {
                            alert("Success");
                            var rowKey = $('#InvoiceID').val();

                            $("#divcreditdetails").empty();
                            $.ajax({
                                type: "post", async: false,
                                url: '/Invoice/getCreditDetails',
                                data: { invoiceno: rowKey },
                                success: function (jsondata) {
                                    if (jsondata.success < 1) {
                                        return;
                                    }
                                    var totamount = 0;
                                    $.each(jsondata.creditlist, function (k, v) {
                                        $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                                        totamount = totamount + v.DebitAmount
                                    });
                                    var amttot = $("#hdnInvoiceAmount").val();
                                    amttot = Number(amttot) + Number(prvamt);
                                    amttot = Number(amttot) - Number(stramt);
                                    $("#txtInvoiceAmount").html(amttot);
                                    $("#hdnInvoiceAmount").val(amttot);

                                },
                                error: function (xhr, st, et) { alert(xhr.responseText); }
                            });
                        },
                        error: function (xhr, st, et) { alert(xhr.responseText); }
                    });
                }
            }
        }

    }

    /*
    function DeleteCredit(id) {
        var prvamt = $("#labeltd" + id + "").text();
        $.ajax({
            type: "post",
            async: false,
            url: '/Invoice/DeleteCredit/',
            data: { "debitId": id },
            success: function (jsondata) {
                alert("Success");
                var rowKey = $('#hdnId').val();

                $("#divcreditdetails").empty();
                $.ajax({
                    type: "post", async: false,
                    url: '/Invoice/getCreditDetails/',
                    data: { invoiceno: rowKey },
                    success: function (jsondata) {
                        if (jsondata.success < 1) {
                            return;
                        }
                        var totamount = 0;
                        $.each(jsondata.creditlist, function (k, v) {
                            $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                            totamount = totamount + v.DebitAmount
                        });

                        var amttot = $("#hdnInvoiceAmount").val();

                        var amtlbt = Number(amttot) + Number(prvamt);
                        $("#txtInvoiceAmount").html(amtlbt);
                        $("#hdnInvoiceAmount").val(amtlbt);


                    },
                    error: function (xhr, st, et) { alert(xhr.responseText); }
                });
            },
            error: function (xhr, st, et) { alert(xhr.responseText); }
        });
    }

*/

    function updateCreditamount(id) {
        var creditid = $("#creditnoteid").val();
        var creditamt = $('#txtamount').val();
        if (creditamt == "") {
            creditamt = "null";
        }
        if (creditamt == "null" || creditamt == "0") {
            alert('Enter Correct Amount');
            return false;
        }
        else {
            if (isNaN(creditamt)) {
                alert("Enter Number");
                return false;
            }
            else {
                $.ajax({
                    type: "post",
                    async: false,
                    url: '/Invoice/UpdateCreditData/',
                    data: { "creditId": creditid, "creditamount": creditamt },
                    success: function (jsondata) {


                        window.location.href = '/Invoice/Invoiceview/';

                    },
                    error: function (xhr, st, et) { alert(xhr.responseText); }
                });
            }
        }
    }
    function ClearText() {
        $("#InvoiceNumber").val("");
        $("#txtInvoiceAmount").val("");
        $("#txtinvoicereceiveddate").val("");
        $("#txtInvoiceDate").val("");
        $("#txtInvoiceDueDate").val("");
        $("#txtpono").val("");
        $("#txtpanno").val("");

        $('#drpdeptid').prop('selectedIndex', 0);
        $('#drpeduserid').prop('selectedIndex', 0);
        $('#drpenduserapproval').prop('selectedIndex', 0);
        $('#drpcostcenterid').prop('selectedIndex', 0);
        $('#drptaxtypeid').prop('selectedIndex', 0);

        $("#drpvendorid").val("");

    }

    function resetImagelist() {
        deletedInvoiceImageList = [];
        frmInvoiceImageList = new window.FormData();
        $("img.imglist").remove();
        $("#tbimglist td").remove();
        currentDisplayedImageTD = null;
        mNumberOfImages = -1;
    }

    function zoom(inout) {

        if ($("div.ec-div img").length < 1) return;
        if ($("#tbimglist tr").length < 1) return;

        $("div.ec-div img").css({
            "height": ($("div.ec-div img")[0].offsetHeight + $("div.ec-div img")[0].offsetHeight * .01 * inout) + "px",
            "width": ($("div.ec-div img")[0].offsetWidth + $("div.ec-div img")[0].offsetWidth * .01 * inout) + "px"
        });
    }
   
    window.Storage["links"] = [];
    function addToInvoiceImagesList() {

        //console.log("First Line");
        var fi = document.getElementById("SupportFile");

        var nof = fi.files.length;

        if (nof < 1) return;
        var allowedfiles = ["jpg", "jpeg", "bmp", "gif", "png", "tif", "tiff","pdf","docx","doc","dot","docm","dotx","docb","dotm","xlsx","xlsm","xltx","xltm","xlsb","xla","xll","xlw"];
        var temdata = new window.FormData();
        var n = 0;
        var startno = mNumberOfImages + 1;


        for (var i = 0; i < nof; i++) {
            var nm = fi.files[i].name;


            var ext = nm.substring(nm.lastIndexOf(".") + 1);
            ext = $.trim(ext.toLowerCase());

            if (allowedfiles.indexOf(ext) < 0) continue;
            mNumberOfImages++;

            frmInvoiceImageList.append("filetoupload" + mNumberOfImages, fi.files[i], fi.files[i].name);
            temdata.append("filetoupload" + mNumberOfImages, fi.files[i], fi.files[i].name);
            n++;
        }

        $("#SupportFile").val("");
        if (n > 0) {

            var xhr = new XMLHttpRequest();
            if (xhr == undefined) { xhr = new ActiveXObject("Microsoft.XMLHTTP"); }
            xhr.onreadystatechange = function () {
                if (this.status == 200 && this.readyState == 4) {
                    var src = JSON.parse(this.responseText).imglist;
                    
                    var icontable = $("#icon-navbar");
                    var i = 1;
                    $.each(src, function (k, z) {

                        //var allowedfiles1 = [".jpg", ".jpeg", ".bmp", ".gif", ".png", ".tif", ".tiff",".pdf"];
                        var allowedfiles1 = [".jpg", ".jpeg", ".bmp", ".gif", ".png", ".tif", ".tiff",".pdf",".docx",".doc",".dot",".docm",".dotx",".docb",".dotm",".xlsx",".xlsm",".xltx",".xltm",".xlsb",".xla",".xll",".xlw"];
                        var arrimag = z.split('~');
                        var v = arrimag[0];
                        //console.log(v);
                        var filename = arrimag[1];

                        var abspath = filename.split("Files")[1];
                        //console.log("abs:"+abspath);
                        var pdffile = filename.substring(filename.lastIndexOf("\\") + 1);
                        var pdffile1 = pdffile.split('/');
                        var ext = filename.substring(filename.lastIndexOf(".") + 1);
                        var supportfile = {};
                        if (ext == "pdf" || ext == "PDF")
                        {
                            //console.log("Ext:" + ext);
                            //window.Storage["links"].push({ FileName: abspath,FileType:ext});
                            supportfile = { InvoiceId:@Model.InvoiceID, FileName: abspath, FileType: ext };
                            $.post("SubmitFiles", supportfile, function (data, status) {
                                //console.log(data);
                                $("#icon-navbar").append("<tr><td><img height='70' src='../Files/pdf.jpg' rel='" + filename + "' title='" +  data.filename + "'/></td></tr>");
                            });

                            
                        }
                        else if(ext == "xls" || ext == "xlsx" )
                        {
                           
                            supportfile = { InvoiceId:@Model.InvoiceID, FileName: abspath, FileType: ext };
                            $.post("SubmitFiles", supportfile, function (data, status) {
                               
                                $("#icon-navbar").append("<tr><td><a href='../Files" + abspath + "' download='"+ pdffile1[1] +"' rel='"+filename+"'><img src='../Files/excel.png' rel='none' title='" + data.filename + "'/></a></td></tr>");
                            });

                           


                        }
                        else if(ext == "doc" || ext == "docx")
                        {
                            
                            supportfile = { InvoiceId:@Model.InvoiceID, FileName: abspath, FileType: ext };
                            $.post("SubmitFiles", supportfile, function (data, status) {
                               
                                $("#icon-navbar").append("<tr><td><a href='../Files" + abspath + "' download='"+pdffile1[1]+"' rel='"+filename+"'><img src='../Files/word.png' rel='none' title='" +  data.filename + "'/></a></td></tr>");
                            });


                        }
                        else if(ext == "jpg" || ext == "jpeg")
                        {
                            
                            supportfile = { InvoiceId:@Model.InvoiceID, FileName: abspath, FileType: ext };
                            $.post("SubmitFiles", supportfile, function (data, status) {
                               
                                $("#icon-navbar").append("<tr><td><a href='#' rel='../Files" + abspath + "' rel='"+filename+"'><img src='../Files/jpeg.png' rel='image' title='" +  data.filename + "'/></a></td></tr>");
                            });


                        }
                        else if (ext == "png") {
                            
                            supportfile = { InvoiceId:@Model.InvoiceID, FileName: abspath, FileType: ext };
                            $.post("SubmitFiles", supportfile, function (data, status) {
                              
                                $("#icon-navbar").append("<tr><td><a href='#' rel='../Files" + abspath + "' rel='"+filename+"' ><img src='../Files/png.jpeg' rel='image' title='" +  data.filename + "'/></a></td></tr>");
                            });


                        }
                       


                        /*
                        if (allowedfiles1.indexOf(ext) >= 0)
                        {

                            $(icontable).append(
                                 "<tr><td><img src='/Files/Temp/" + pdffile + "' class='ec-invoice-image-icon can' title="+pdffile1[1] +" onclick='ec_showInvoiceImage(this);'/></td></tr>"
                                 );
                        }
                        else
                        {
                            if(ext== '.pdf')
                            {
                                console.log("PDF");

                                $(icontable).append(
                                  "<tr><td> <img  src='/ViewerJS/#../Files/Temp/" + pdffile + "' class='ec-invoice-image-icon can'  title="+pdffile1[1] +" onmousedown='ec_showInvoiceImage1(this);' onmouseup='ec_showInvoiceImage(this);' /></td></tr>"
                                 );

                            }
                            else if(ext == '.docx' || ext == '.doc' || ext == '.dot' || ext == '.docm' || ext == '.dotx' || ext == '.dotm' || ext == '.docb')
                            {
                                $(icontable).append(
                            "<tr><td> <a class=\"media\" href='/Files/Temp/" + pdffile + "' target=\"_blank\"  >  <img class='ec-invoice-image-icon can' src='/Files/word.jpg' title="+pdffile1[1] +" /></a></td></tr>"
                           );
                            }
                            else if(ext == '.xlsx' || ext == '.xlsm' || ext == '.xltx' || ext == '.xltm' || ext == '.xlsb' || ext == '.xla' || ext == '.xll' || ext == '.xlw')
                            {
                                $(icontable).append(
                            "<tr><td> <a class=\"media\" href='/Files/Temp/" + pdffile + "' target=\"_blank\"  >  <img class='ec-invoice-image-icon can' src='/Files/excel.jpg' title="+pdffile1[1] +" /></a></td></tr>"
                           );
                            }
                        }
                        */

                        i++;
                        startno++;
                    });

                    if (i == 1) {


                        currentDisplayedImageTD = $("table.ec-table-invoice-image-icons tr:first td:last");
                        $("tr:first", $(icontable)).addClass("current-invoice-image-icon")

                        var rsrc=  $("tr:first td:first img", $(icontable))[0].src;
                        var rext = rsrc.substring(rsrc.lastIndexOf(".") + 1);
                        if( rext != "pdf" )
                        {
                            $("div.ec-div-invoice-image img")[0].src = $("tr:first td:last img", $(icontable))[0].src;
                            $("div.ec-div-invoice-image img:first").attr("src",$("tr:first td:last img:first", $(icontable)).attr("src"));
                            //$("#printimg").attr("src",$("tr:first td:first img:first", $(icontable)).attr("src"));
                            $("div.ec-div-invoice-image iframe").hide();
                            $("div.ec-div-invoice-image img").show();
                            $(".zoombtn").show();
                            // wheelzoom(document.getElementById('imgInvoiceImage'));


                        }
                        else
                        {

                            $("div.ec-div-invoice-image iframe")[0].src = $("tr:first td:last img", $(icontable))[0].src;
                            $("div.ec-div-invoice-image iframe:first").attr("src",$("tr:first td:last img:first", $(icontable)).attr("src"));
                            $("div.ec-div-invoice-image img").hide();
                            $("div.ec-div-invoice-image iframe").show();
                            $(".zoombtn").hide();
                        }

                    }
                    var n = $("#tbimglist td").length;
                    $("#spannof").show();
                    //$("#spannof").text(($(currentDisplayedImageTD)[0].cellIndex + 1) +"/" + n);
                }
            };
            xhr.open('POST', "@Url.Action("NewgetImageLists", "Invoice")", true);
            xhr.send(temdata);
        }
    }

</script>
<script>

    $(document).ready(function () {


 
        var oldactive = $();
       // $("#imgviewer").addClass("hide-display");


        //10428
        (function () {
            var data = { invoiceno:@Model.InvoiceID};
           // console.log(data);
            $.ajax({
                type: "GET", async: false,
                url: '/Invoice/getCreditDetailss',
               data: { invoiceno: @Model.InvoiceID },
                success: function (jsondata) {
                    if (jsondata.success < 1) {
                        return;
                    }
                    var totamount = 0;
                    $.each(jsondata.creditlist, function (k, v) {
                        $("#divcreditdetails").append("<tr><td><label id='UserID" + v.DebitNoteId + "' class='edit-mode'>" + v.DebitNoteId + "</label></td><td><span class='display-mode'><a href='/Invoice/DownloadFile/" + v.DebitNoteId + "'>" + v.DebitFileName + "</a></span></td><td id=labeltd" + v.DebitNoteId + ">" + v.DebitAmount + " </td><td style='display:none' id='editTd" + v.DebitNoteId + "'><input type='text' style='display:none' value='" + v.DebitAmount + "' id='inputamount" + v.DebitNoteId + "'/></td><td><a href='#' id='addcontractbtn" + v.DebitNoteId + "' onclick='editDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Edit</a><a href='#' id='updatecontractbtn" + v.DebitNoteId + "' style='display:none' onclick='UpdateDetails(" + v.DebitNoteId + ")' class='btn btn-default button2'>Update</a>&nbsp<a href='#' id='DeleteCredit' onclick='DeleteCredit(" + v.DebitNoteId + ")' class='btn btn-default button2'>Delete</a></td></tr>");
                        totamount = totamount + v.DebitAmount
                    });

                    var amttot = $("#hdnInvoiceAmount").val();

                    var amtlbt = Number(amttot) + Number(prvamt);
                    $("#txtInvoiceAmount").html(amtlbt);
                    $("#hdnInvoiceAmount").val(amtlbt);


                },
                error: function (xhr, st, et) { alert(xhr.responseText); }
            });
            //var defaultlocation = "D:\\InvoiceNew\\InvoiceNew\\Files\\Temp\\62c7c5ba-787e-4857-b675-137a16e9f424\\Invoice_Bizerba.pdf";
            

            var spath = decodeURIComponent($("#object_id").attr("data")).split("=")[1];
            
            var defaultlocation = spath;
            var extde = spath.substring(spath.lastIndexOf(".") + 1).toLowerCase();
            if (extde == "jpg")
            {
                //console.log("First Time JPG");
                $("#icon-navbar").append("<tr><td><img height='70' src='../Files/jpeg.png' drel='" + extde + "'  rel='" + defaultlocation + "' title='default'/></td></tr>");
            }
            else {
                $("#icon-navbar").append("<tr><td><img height='70' src='../Files/pdf.jpg' drel='' rel='" + defaultlocation + "' title='default'/></td></tr>");
            }
            

            $.post("GetSupportFiles", data, function (data, status) {

                console.log("data");
                console.log(data);
                data.forEach(function(curr,index,arr){

                    var fullname = curr.FileName;
                    
                    var filename = fullname.split("InvoiceImages\\")[1];
                    var ext = filename.substring(filename.lastIndexOf(".") + 1);
                    console.log("Ext:"+ext);
                    var abspath = fullname.split("Files")[1];
                    if(ext == "pdf" || ext == "PDF")
                    {
                        $("#icon-navbar").append("<tr><td><img height='70' src='../Files/pdf.jpg' rel='" + fullname + "' title='" + filename + "'/></td></tr>");
                    }
                    else if(ext == "xls" || ext == "xlsx" )
                    {

                        $("#icon-navbar").append("<tr><td><a href='../Files" + abspath + "' rel='"+fullname+"' download='"+ filename +"'><img src='../Files/excel.png' rel='none' title='" + filename + "'/></a></td></tr>");
                    }
                    else if(ext == "doc" || ext == "docx")
                    {

                        $("#icon-navbar").append("<tr><td><a href='../Files" + abspath + "' rel='"+fullname+"' download='"+filename+"'><img src='../Files/word.png' rel='none' title='" + filename + "'/></a></td></tr>");

                    }
                    else if(ext == "jpg" || ext == "jpeg")
                    {

                        $("#icon-navbar").append("<tr><td><a href='#' rel='../Files" + abspath + "' rel='"+fullname+"'><img src='../Files/jpeg.png' rel='image' title='" + filename + "'/></a></td></tr>");

                    }
                    else if(ext == "png")
                    {

                        $("#icon-navbar").append("<tr><td><a href='#' rel='../Files" + abspath + "' rel='"+fullname+"' ><img src='../Files/png.jpeg' rel='image' title='" + filename + "'/></a></td></tr>");
                    }


                });
            });

          
        })();

               
        $("#icon-navbar").on('click', "tr", function () {

            $(oldactive).removeClass("nav-active");
            oldactive = $(this).addClass('nav-active');
            var clickedchild = $(this).parent().children().index(this) + 1;
            
            var filerel = $("#icon-navbar tr:nth-child(" + clickedchild + ") img").attr('rel');
            var title = $("#icon-navbar tr:nth-child(" + clickedchild + ") img").attr("drel");
            
            
            if (title == "jpg") {
                $("#object_id").addClass("hide-display");
                $("#imgviewer").removeClass("hide-display");
                var rel = $("tr:nth-child(" + clickedchild + ") img").attr("rel");
                
                $("#imgviewer > img").attr("src", "getfile?filepath="+encodeURIComponent(rel));
               
            }
            else {
                if (filerel == "image") {
                    $("#object_id").addClass("hide-display");
                    $("#imgviewer").removeClass("hide-display");

                    $("#imgviewer > img").attr("src", $("tr:nth-child(" + clickedchild + ") a").attr("rel"));
                }
                else if (filerel != "none") {
                    $("#imgviewer").addClass("hide-display");
                    $("#object_id").removeClass("hide-display");
                    $("#object_id").attr("data", "getfile?filepath=" + encodeURIComponent(filerel));
                }
            }
        });
        
            
        
        /*
        $("#somebutton").on('click', function () {
            var name = "Sankalp";
            var phone = "9451852666";

            //links.push("www.google.com");
            //links.push("www.facebook.com");

            //var data = { Name: name, Phone: phone, Links: links };
           // var formdata = $("#invoceupdateform").serialize();
            //var data = { InVoiceFiles: window.Storage["links"] };

            console.log("Data:"+data);
            //formdata.push(data);


        });*/


        
 


        //$("#VendorName").autocomplete({
        //    source: function (request,response) {
        //        debugger;
        //        $.ajax({
        //            url: '/Invoice/AutoComplete',
        //            dataType: 'json',
        //            method: 'POST',
        //            success: function (data) {
        //                response($.map(data, function (item) {
        //                    return { label: item.label, value: item.val };
        //                }))
        //            }
        //        });
        //    }
        //});

        $(function () {
            var availableTags = [];
            var availableIds = [];
            $.ajax({
                url: '/Invoice/getvendor/',
                dataType: 'json',
                success: function (months) {

                    $.each(months, function (index, month) {

                        availableTags.push(month.text);

                    });

                }
            });

            $("#drpvendorid").autocomplete({
                source: availableTags,
            });
        });
    });
</script>

<script>

        function performdelete(){
            var clickedobj = $("#icon-navbar > tbody > tr.nav-active img");
            var imgrel = $("#icon-navbar > tbody > tr.nav-active img").attr("rel");
            if(imgrel == "none" || imgrel == "image" && $(clickedobj).attr("title")!= "default")
            {
                var docrel = $(clickedobj).attr("title");
                var file = docrel.substring(docrel.lastIndexOf("\\") + 1);
                var data = {filename:file};
                $.post("DeleteFileByName",data,function(data,status){
                        $(clickedobj).parent().parent().parent().remove();
                        });
            }
            else if($(clickedobj).attr("title")!= "default") {
            var pdfrel = $(clickedobj).attr("title");
            var file = pdfrel.substring(pdfrel.lastIndexOf("\\") + 1);
            var data = {filename:file};
            $.post("DeleteFileByName",data,function(data,status){
                    $(clickedobj).parent().parent().remove();
                    });
            }
            else{
                    swal("Sorry !", "Your can't delete the Default file", "error");
                }

            }

            $("#remove").click(function(){
                    var clickedobj = $("#icon-navbar > tbody > tr.nav-active img").attr('title');
                    if(clickedobj != "default")
                    {
                        confirmation();
                    }
                    else {
                            swal("Sorry !", "Your can't delete default file", "error");
                        }
                                   
                });
                function confirmation(){
                    swal({
                            title: "Are you sure?",
                            text: "You will not be able to recover this file!",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#3C8DBC",
                            confirmButtonText: "Yes, delete it!",
                            cancelButtonText: "No, cancel plz!",
                            closeOnConfirm: true,
                            closeOnCancel: true
                        },
                        function(isConfirm){
                        if (isConfirm) {
                                performdelete();
                                    } else {
                                    }
                        });
                }

                function itemconfirmation(id){
                    swal({
                        title: "Are you sure?",
                        text: "You will not be able to recover this Item!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#3C8DBC",
                        confirmButtonText: "Yes, delete it!",
                        cancelButtonText: "No, cancel plz!",
                        closeOnConfirm: true,
                        closeOnCancel: true
                    },
                        function(isConfirm){
                            if (isConfirm) {
                                //console.log();
                                $(".item-list > tbody tr#" + id).hide('slow', function () {
                                    
                                    var id = $(this).attr("id").replace(/^\D+/g, '');
                                    var updatetype = $("#update" + id).val();
                                    if (updatetype == "insert") {
                                        $(".item-list > tbody tr#" + id).remove();
                                    }
                                    else {

                                        $.post("DeleteItemData", { updatetype }, function (data, status) {

                                            console.log(status);
                                            if (status == "success") {
                                                $(".item-list > tbody tr#" + id).remove();
                                            }

                                        });
                                    }
                                });
                            } else {
                            }
                        });
                }



                console.log("registered");
                $(".item-list > tbody").on("click",".delete",function(){ 
                    //var id = $(this).attr("id").substr(6,2);
                    var id = $(this).attr("id").replace( /^\D+/g, '');
                    itemconfirmation(id);
                    /*
                    $(".item-list > tbody tr#"+id).hide('slow', function(){ 
                        $(".item-list > tbody tr#"+id).remove(); 
                    });*/
                    //$(".item-list > tbody tr#"+id).remove();
                });
                 /*
                $("#addItem").click(function(){

                    var id = parseInt($(".item-list > tbody").children().last().attr("id"));
                    if(typeof(id) === "undefined" || isNaN(id))
                    {
                        var index = 0;
                        $(".item-list > tbody").append("<tr id='"+index+"'><td><input type='hidden' name='update"+index+"' value='insert' /><input id='id"+index+"' class='form-control' name='id"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='code"+index+"' name='code"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='name"+index+"' name='name"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='qty"+index+"' name='qty"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='rate"+index+"' name='rate"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='igst"+index+"' name='igst"+index+"' type='text' value=' ' /><td><input class='form-control' id='sgst"+index+"' name='sgst"+index+"' type='text' value=' ' /><td><input class='form-control' id='cgst"+index+"' name='cgst"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='amount"+index+"' name='amount"+index+"' type='text' value=' ' /></td><td><button type='button' id='delete"+index+"' class='delete btn btn-primary'>Delete</button></td></tr>");
                        //$("<tr id='"+index+"'><td><input id='id"+index+"' name='id"+index+"' type='text' value=' ' /></td><td><input id='code"+index+"' name='code"+index+"' type='text' value=' ' /></td><td><input id='name"+index+"' name='name"+index+"' type='text' value=' ' /></td><td><input id='qty"+index+"' name='qty"+index+"' type='text' value=' ' /></td><td><input id='rate"+index+"' name='rate"+index+"' type='text' value=' ' /></td><td><input id='igst"+index+"' name='igst"+index+"' type='text' value=' ' /><td><input id='sgst"+index+"' name='sgst"+index+"' type='text' value=' ' /><td><input id='cgst"+index+"' name='cgst"+index+"' type='text' value=' ' /></td><td><input id='amount"+index+"' name='amount"+index+"' type='text' value=' ' /></td><td><button type='button' id='delete"+index+"' class='delete btn btn-primary'>Delete</button></td></tr>").appendTo(".item-list > tbody");
                    }
                    else{
                
                        var index = id+1;
                        $(".item-list > tbody").append("<tr id='"+index+"'><td><input type='hidden' name='update"+index+"' value='insert' /><input id='id"+index+"' class='form-control' name='id"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='code"+index+"' name='code"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='name"+index+"' name='name"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='qty"+index+"' name='qty"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='rate"+index+"' name='rate"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='igst"+index+"' name='igst"+index+"' type='text' value=' ' /><td><input class='form-control' id='sgst"+index+"' name='sgst"+index+"' type='text' value=' ' /><td><input class='form-control' id='cgst"+index+"' name='cgst"+index+"' type='text' value=' ' /></td><td><input class='form-control' id='amount"+index+"' name='amount"+index+"' type='text' value=' ' /></td><td><button type='button' id='delete"+index+"' class='delete btn btn-primary'>Delete</button></td></tr>");
                    }
            
                });*/

         
</script>
<style>
    .nav-active{
        background-color: rgba(60, 141, 188, 0.75);
    }
    #icon-navbar img{
        width:73px!important;
        float:right;
    }
    .hide-display{
        display:none!important;
    }
</style>
<script src="~/Scripts/jqGrid/jquery.jqDatePicker.min.js"></script>
@*<script src="https://code.jquery.com/jquery-1.12.4.js"></script>*@
@*<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>*@


